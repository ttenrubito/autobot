# ğŸª Chatbot Commerce Specification v2.0
## à¸£à¹‰à¸²à¸™à¹€à¸®à¸‡ à¹€à¸®à¸‡ à¹€à¸®à¸‡ - à¸ªà¸´à¸™à¸„à¹‰à¸²à¹à¸šà¸£à¸™à¸”à¹Œà¹€à¸™à¸¡à¸¡à¸·à¸­à¸ªà¸­à¸‡

> **à¸§à¸±à¸™à¸—à¸µà¹ˆà¸­à¸­à¸à¹à¸šà¸š:** 2026-01-06  
> **à¸ªà¸–à¸²à¸™à¸°:** âœ… Confirmed - à¸à¸£à¹‰à¸­à¸¡à¹€à¸£à¸´à¹ˆà¸¡à¸à¸±à¸’à¸™à¸²  
> **à¸œà¸¹à¹‰à¸£à¸±à¸šà¸œà¸´à¸”à¸Šà¸­à¸š:** Box Design Development Team

---

## ğŸ“‹ à¸ªà¸²à¸£à¸šà¸±à¸

1. [à¸ªà¸£à¸¸à¸›à¸ à¸²à¸à¸£à¸§à¸¡à¸˜à¸¸à¸£à¸à¸´à¸ˆ](#1-à¸ªà¸£à¸¸à¸›à¸ à¸²à¸à¸£à¸§à¸¡à¸˜à¸¸à¸£à¸à¸´à¸ˆ)
2. [4 Use Cases à¸«à¸¥à¸±à¸](#2-4-use-cases-à¸«à¸¥à¸±à¸)
3. [Database Schema Analysis](#3-database-schema-analysis)
4. [API Specification](#4-api-specification)
5. [Bot Profile Design](#5-bot-profile-design)
6. [Admin Monitor Screens](#6-admin-monitor-screens)
7. [Implementation Checklist](#7-implementation-checklist)
8. [Test Cases](#8-test-cases)
9. [à¸„à¸³à¸–à¸²à¸¡à¹à¸¥à¸°à¸„à¸³à¸•à¸­à¸šà¸ˆà¸²à¸à¸—à¸µà¸¡ Sales](#9-à¸„à¸³à¸–à¸²à¸¡à¹à¸¥à¸°à¸„à¸³à¸•à¸­à¸šà¸ˆà¸²à¸à¸—à¸µà¸¡-sales)
10. [ğŸ”´ Admin Handoff Mechanism](#10-admin-handoff-mechanism)
11. [ğŸ”´ Image Classification Logic](#11-image-classification-logic)
12. [ğŸ”´ Vector Search Integration](#12-vector-search-integration)
13. [ğŸ”´ Critical Edge Cases](#13-critical-edge-cases)

---

## 1. à¸ªà¸£à¸¸à¸›à¸ à¸²à¸à¸£à¸§à¸¡à¸˜à¸¸à¸£à¸à¸´à¸ˆ

### 1.1 à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸£à¹‰à¸²à¸™
| à¸£à¸²à¸¢à¸à¸²à¸£ | à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸” |
|--------|------------|
| **à¸Šà¸·à¹ˆà¸­à¸£à¹‰à¸²à¸™** | à¹€à¸®à¸‡ à¹€à¸®à¸‡ à¹€à¸®à¸‡ |
| **à¸›à¸£à¸°à¹€à¸ à¸—à¸˜à¸¸à¸£à¸à¸´à¸ˆ** | à¸ªà¸´à¸™à¸„à¹‰à¸²à¹à¸šà¸£à¸™à¸”à¹Œà¹€à¸™à¸¡à¸¡à¸·à¸­à¸ªà¸­à¸‡ |
| **à¸ªà¸´à¸™à¸„à¹‰à¸²à¸«à¸¥à¸±à¸** | à¸™à¸²à¸¬à¸´à¸à¸² (Rolex, TAG Heuer, Omega), à¹à¸«à¸§à¸™, à¸ªà¸£à¹‰à¸­à¸¢à¸„à¸­, à¸ªà¸£à¹‰à¸­à¸¢à¸‚à¹‰à¸­à¸¡à¸·à¸­, à¸•à¹ˆà¸²à¸‡à¸«à¸¹, à¸ˆà¸µà¹‰à¹€à¸à¸Šà¸£, à¸à¸£à¸°à¸—à¸­à¸‡, à¸à¸£à¸°, à¸•à¸¥à¸±à¸šà¸à¸£à¸°, à¸Šà¸¸à¸”/Set, à¸à¸§à¸‡à¸à¸¸à¸à¹à¸ˆ, à¸•à¸¥à¸±à¸šà¸—à¸­à¸‡, à¹€à¸‚à¹‡à¸¡à¸à¸¥à¸±à¸”à¹€à¸à¸Šà¸£ |
| **à¸Šà¹ˆà¸§à¸‡à¸£à¸²à¸„à¸²** | 10,000 - 1,000,000+ à¸šà¸²à¸— |
| **à¸šà¸£à¸´à¸à¸²à¸£à¹€à¸à¸´à¹ˆà¸¡à¹€à¸•à¸´à¸¡** | à¸£à¸±à¸šà¸ˆà¸³à¸™à¸³ |

### 1.2 à¸Šà¹ˆà¸­à¸‡à¸—à¸²à¸‡à¹à¸¥à¸°à¸›à¸£à¸´à¸¡à¸²à¸“
| à¸Šà¹ˆà¸­à¸‡à¸—à¸²à¸‡ | à¸›à¸£à¸´à¸¡à¸²à¸“/à¸§à¸±à¸™ | à¸ªà¸±à¸”à¸ªà¹ˆà¸§à¸™ |
|---------|-----------|---------|
| Facebook Messenger | 100-120 à¹à¸Šà¸— | 60% |
| LINE OA | 70 à¹à¸Šà¸— | 40% |
| **à¸£à¸§à¸¡** | ~170-190 à¹à¸Šà¸—/à¸§à¸±à¸™ | 100% |

### 1.3 à¸—à¸µà¸¡à¸‡à¸²à¸™
- **à¹à¸­à¸”à¸¡à¸´à¸™:** 2 à¸„à¸™ (à¸„à¸¸à¸“à¹‚à¸­à¹‹, à¸„à¸¸à¸“à¸™à¸±à¸—à¸•à¸µà¹‰)
- **à¸«à¸™à¹‰à¸²à¸—à¸µà¹ˆ:** à¸•à¸­à¸šà¹à¸Šà¸—, à¹€à¸ªà¸™à¸­à¸‚à¸²à¸¢, à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸¢à¸­à¸”, à¸ˆà¸±à¸”à¸ªà¹ˆà¸‡à¸ªà¸´à¸™à¸„à¹‰à¸², à¸•à¸´à¸”à¸•à¸²à¸¡à¸¥à¸¹à¸à¸„à¹‰à¸² (à¸¡à¸±à¸”à¸ˆà¸³/à¸­à¸­à¸¡/à¸•à¹ˆà¸­à¸”à¸­à¸), à¸›à¸£à¸°à¸ªà¸²à¸™à¸‡à¸²à¸™à¸‹à¹ˆà¸­à¸¡
- **à¸œà¸¹à¹‰à¸„à¸µà¸¢à¹Œà¸‚à¹‰à¸­à¸¡à¸¹à¸¥:** à¸„à¸¸à¸“à¸”à¸²à¸§ (à¸­à¸±à¸›à¹€à¸”à¸•à¸ªà¸–à¸²à¸™à¸°à¹ƒà¸™à¸£à¸°à¸šà¸š NPD)

### 1.4 à¸£à¸°à¸šà¸šà¸«à¸¥à¸±à¸‡à¸šà¹‰à¸²à¸™à¸—à¸µà¹ˆà¸¡à¸µà¸­à¸¢à¸¹à¹ˆ
- **à¸£à¸°à¸šà¸š NPD:** à¹€à¸à¹‡à¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ªà¸´à¸™à¸„à¹‰à¸²à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”, à¸­à¸±à¸›à¹€à¸”à¸•à¸•à¸±à¸”à¸‚à¸²à¸¢à¸ªà¸´à¸™à¸„à¹‰à¸², à¸ªà¸–à¸²à¸™à¸°à¸ªà¸´à¸™à¸„à¹‰à¸²

---

## 2. 4 Use Cases à¸«à¸¥à¸±à¸

### 2.1 Use Case #1: à¸„à¹‰à¸™à¸«à¸²/à¸ªà¸­à¸šà¸–à¸²à¸¡à¸ªà¸´à¸™à¸„à¹‰à¸²

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     à¸¥à¸¹à¸à¸„à¹‰à¸²à¸—à¸±à¸à¸¡à¸²                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ à¸ªà¹ˆà¸‡à¸£à¸¹à¸›à¸ à¸²à¸     â”‚ à¸à¸´à¸¡à¸à¹Œ keyword â”‚ à¸ªà¹ˆà¸‡à¸£à¸«à¸±à¸ªà¸ªà¸´à¸™à¸„à¹‰à¸² â”‚          â”‚
â”‚  â”‚ (à¹à¸„à¸›à¸ˆà¸²à¸à¹€à¸à¸ˆ)  â”‚ (Rolex/à¸™à¸²à¸¬à¸´à¸à¸²)â”‚ (SKU/Code)    â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚          â”‚               â”‚               â”‚                   â”‚
â”‚          â–¼               â–¼               â–¼                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚              Vector/Keyword Search                 â”‚      â”‚
â”‚  â”‚        (à¹€à¸£à¸µà¸¢à¸ NPD API â†’ /v1/products/search)      â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                          â–¼                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  à¹à¸ªà¸”à¸‡à¸œà¸¥à¸ªà¸´à¸™à¸„à¹‰à¸²: à¸Šà¸·à¹ˆà¸­, à¸£à¸«à¸±à¸ª, à¸£à¸²à¸„à¸², à¸ªà¸ à¸²à¸, à¸£à¸¹à¸›         â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                          â–¼                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  à¸¥à¸¹à¸à¸„à¹‰à¸²à¸–à¸²à¸¡à¹€à¸à¸´à¹ˆà¸¡: à¸ªà¸ à¸²à¸/à¸•à¸³à¸«à¸™à¸´/à¸­à¸¸à¸›à¸à¸£à¸“à¹Œ/à¸›à¸£à¸°à¸à¸±à¸™/à¸•à¹ˆà¸­à¸£à¸­à¸‡ â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                          â–¼                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  âš ï¸ à¸ˆà¸¸à¸”à¸ªà¹ˆà¸‡à¸•à¹ˆà¸­ Admin:                               â”‚      â”‚
â”‚  â”‚  - à¸¥à¸¹à¸à¸„à¹‰à¸²à¸ªà¸™à¹ƒà¸ˆ call à¸”à¸¹à¸ªà¸´à¸™à¸„à¹‰à¸²                        â”‚      â”‚
â”‚  â”‚  - à¸¥à¸¹à¸à¸„à¹‰à¸²à¸•à¹‰à¸­à¸‡à¸à¸²à¸£à¸¡à¸±à¸”à¸ˆà¸³                              â”‚      â”‚
â”‚  â”‚  - à¸¥à¸¹à¸à¸„à¹‰à¸²à¸•à¹‰à¸­à¸‡à¸à¸²à¸£à¸‹à¸·à¹‰à¸­/à¸Šà¸³à¸£à¸°à¹€à¸‡à¸´à¸™                      â”‚      â”‚
â”‚  â”‚  - à¸¥à¸¹à¸à¸„à¹‰à¸²à¸‚à¸­à¸ªà¹ˆà¸§à¸™à¸¥à¸”                                  â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Required Slots:**
- `query_type`: image | keyword | product_code
- `query_value`: image_url | keyword_text | product_code
- `product_ref_id`: (after search result selected)

**Intents:**
- `product_lookup_by_image`
- `product_lookup_by_code`
- `product_availability`
- `price_inquiry`

---

### 2.2 Use Case #2: à¹à¸ˆà¹‰à¸‡à¸Šà¸³à¸£à¸°à¹€à¸‡à¸´à¸™à¸ˆà¹ˆà¸²à¸¢à¹€à¸•à¹‡à¸¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     à¸¥à¸¹à¸à¸„à¹‰à¸²à¹à¸ˆà¹‰à¸‡à¹‚à¸­à¸™à¹€à¸‡à¸´à¸™                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ à¸ªà¹ˆà¸‡à¸£à¸¹à¸›à¸ªà¸¥à¸´à¸› + à¸­à¸²à¸ˆà¸à¸´à¸¡à¸à¹Œ "à¹‚à¸­à¸™à¹à¸¥à¹‰à¸§" / "à¸Šà¸³à¸£à¸°à¹à¸¥à¹‰à¸§"       â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                          â–¼                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  Vision OCR: à¸•à¸£à¸§à¸ˆà¸ˆà¸±à¸š à¸ªà¸¥à¸´à¸› â†’ Extract à¸¢à¸­à¸”/à¹€à¸§à¸¥à¸²/à¸Šà¸·à¹ˆà¸­  â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                          â–¼                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  à¸–à¸²à¸¡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸µà¹ˆà¸‚à¸²à¸”:                                  â”‚      â”‚
â”‚  â”‚  - à¸Šà¸³à¸£à¸°à¸ªà¸³à¸«à¸£à¸±à¸šà¸ªà¸´à¸™à¸„à¹‰à¸²à¸­à¸°à¹„à¸£? (à¸–à¹‰à¸²à¹„à¸¡à¹ˆà¸£à¸¹à¹‰)                â”‚      â”‚
â”‚  â”‚  - à¹€à¸¥à¸‚à¸­à¸­à¹€à¸”à¸­à¸£à¹Œ/à¸£à¸«à¸±à¸ªà¸ªà¸´à¸™à¸„à¹‰à¸² (optional)                 â”‚      â”‚
â”‚  â”‚  - à¸¢à¸·à¸™à¸¢à¸±à¸™à¸¢à¸­à¸” (à¸–à¹‰à¸² OCR à¹„à¸¡à¹ˆà¸Šà¸±à¸”)                       â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                          â–¼                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  à¸šà¸±à¸™à¸—à¸¶à¸à¹€à¸‚à¹‰à¸²à¸£à¸°à¸šà¸š â†’ à¸ªà¸–à¸²à¸™à¸°: pending                   â”‚      â”‚
â”‚  â”‚  â†’ à¹à¸ˆà¹‰à¸‡à¸¥à¸¹à¸à¸„à¹‰à¸²: "à¸£à¸±à¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹à¸¥à¹‰à¸§ à¸£à¸­à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸š"           â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                          â–¼                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  Admin à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸š (à¸«à¸™à¹‰à¸² Monitor)                      â”‚      â”‚
â”‚  â”‚  â†’ Approve: à¹à¸ˆà¹‰à¸‡à¸¥à¸¹à¸à¸„à¹‰à¸² + à¸–à¸²à¸¡à¸—à¸µà¹ˆà¸­à¸¢à¸¹à¹ˆà¸ˆà¸±à¸”à¸ªà¹ˆà¸‡          â”‚      â”‚
â”‚  â”‚  â†’ Reject: à¹à¸ˆà¹‰à¸‡à¸¥à¸¹à¸à¸„à¹‰à¸² + à¹€à¸«à¸•à¸¸à¸œà¸¥                     â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Required Slots:**
- `slip_image_url`: URL à¸£à¸¹à¸›à¸ªà¸¥à¸´à¸›
- `amount`: à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™ (from OCR or user input)
- `payment_time`: à¹€à¸§à¸¥à¸²à¹‚à¸­à¸™ (from OCR or user input)
- `sender_name`: à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹‚à¸­à¸™ (from OCR or user input)
- `product_ref`: à¸£à¸«à¸±à¸ªà¸ªà¸´à¸™à¸„à¹‰à¸²/order_no (optional)

**Intents:**
- `payment_slip_verify`

---

### 2.3 Use Case #3: à¹à¸ˆà¹‰à¸‡à¸Šà¸³à¸£à¸°à¹€à¸‡à¸´à¸™à¸œà¹ˆà¸­à¸™

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     à¸¥à¸¹à¸à¸„à¹‰à¸²à¹à¸ˆà¹‰à¸‡à¸œà¹ˆà¸­à¸™                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  A) à¹€à¸›à¸´à¸”à¸œà¹ˆà¸­à¸™à¹ƒà¸«à¸¡à¹ˆ: "à¸ªà¸™à¹ƒà¸ˆà¸œà¹ˆà¸­à¸™" + à¸ªà¸´à¸™à¸„à¹‰à¸²              â”‚      â”‚
â”‚  â”‚  B) à¸ˆà¹ˆà¸²à¸¢à¸‡à¸§à¸”: "à¸ˆà¹ˆà¸²à¸¢à¸‡à¸§à¸”" / "à¸Šà¸³à¸£à¸°à¸œà¹ˆà¸­à¸™" + à¸ªà¸¥à¸´à¸›         â”‚      â”‚
â”‚  â”‚  C) à¸•à¹ˆà¸­à¸”à¸­à¸: "à¸•à¹ˆà¸­à¸”à¸­à¸" / "à¸¢à¸·à¸”à¹€à¸§à¸¥à¸²"                   â”‚      â”‚
â”‚  â”‚  D) à¸ªà¸­à¸šà¸–à¸²à¸¡: "à¹€à¸«à¸¥à¸·à¸­à¸à¸µà¹ˆà¸‡à¸§à¸”" / "à¸‡à¸§à¸”à¸•à¹ˆà¸­à¹„à¸›à¹€à¸—à¹ˆà¸²à¹„à¸£"       â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                          â–¼                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ A) à¹ƒà¸«à¸¡à¹ˆ     â”‚ B) à¸ˆà¹ˆà¸²à¸¢à¸‡à¸§à¸” â”‚ C) à¸•à¹ˆà¸­à¸”à¸­à¸  â”‚ D) à¸–à¸²à¸¡ â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”¬â”€â”€â”€â”€â”˜       â”‚
â”‚         â–¼             â–¼             â–¼          â–¼            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚à¹€à¸à¹‡à¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥  â”‚ â”‚à¹€à¸à¹‡à¸šà¸ªà¸¥à¸´à¸›   â”‚ â”‚à¸šà¸±à¸™à¸—à¸¶à¸   â”‚ â”‚à¸”à¸¶à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥â”‚       â”‚
â”‚  â”‚à¸ªà¸´à¸™à¸„à¹‰à¸²+à¸‡à¸§à¸” â”‚ â”‚+à¸‡à¸§à¸”à¸—à¸µà¹ˆà¸ˆà¹ˆà¸²à¸¢â”‚ â”‚à¸•à¹ˆà¸­à¸”à¸­à¸   â”‚ â”‚à¹à¸ªà¸”à¸‡à¸œà¸¥  â”‚       â”‚
â”‚  â”‚â†’à¸ªà¹ˆà¸‡ Admin â”‚ â”‚â†’à¸ªà¹ˆà¸‡ Admin â”‚ â”‚â†’à¸ªà¹ˆà¸‡ Adminâ”‚ â”‚à¸•à¸²à¸£à¸²à¸‡   â”‚       â”‚
â”‚  â”‚à¸­à¸™à¸¸à¸¡à¸±à¸•à¸´    â”‚ â”‚à¸•à¸£à¸§à¸ˆ       â”‚ â”‚à¸•à¸£à¸§à¸ˆ     â”‚ â”‚à¸œà¹ˆà¸­à¸™    â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                          â–¼                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  à¸«à¸¥à¸±à¸‡ Admin Approve:                               â”‚      â”‚
â”‚  â”‚  â†’ à¹à¸ˆà¹‰à¸‡à¸¥à¸¹à¸à¸„à¹‰à¸²: à¸‡à¸§à¸”à¸–à¸±à¸”à¹„à¸› à¸§à¸±à¸™à¸—à¸µà¹ˆ X à¸¢à¸­à¸” Y à¸šà¸²à¸—         â”‚      â”‚
â”‚  â”‚  â†’ à¸«à¸£à¸·à¸­: à¸ˆà¹ˆà¸²à¸¢à¸„à¸£à¸šà¹à¸¥à¹‰à¸§! à¸™à¸±à¸”à¸£à¸±à¸šà¸‚à¸­à¸‡/à¸ˆà¸±à¸”à¸ªà¹ˆà¸‡             â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Required Slots:**
- `action_type`: new | pay | extend_interest | inquiry
- `installment_id` or `order_ref` or `customer_phone`: à¸£à¸°à¸šà¸¸à¸šà¸±à¸à¸Šà¸µà¸œà¹ˆà¸­à¸™
- `period_number`: à¸‡à¸§à¸”à¸—à¸µà¹ˆà¸ˆà¹ˆà¸²à¸¢ (for pay action)
- `amount`: à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™
- `slip_image_url`: à¸£à¸¹à¸›à¸ªà¸¥à¸´à¸› (for pay/extend)

**Intents:**
- `installment_new`: à¹€à¸›à¸´à¸”à¸œà¹ˆà¸­à¸™à¹ƒà¸«à¸¡à¹ˆ
- `installment_pay`: à¸ˆà¹ˆà¸²à¸¢à¸‡à¸§à¸”
- `installment_extend`: à¸•à¹ˆà¸­à¸”à¸­à¸
- `installment_inquiry`: à¸ªà¸­à¸šà¸–à¸²à¸¡à¸¢à¸­à¸”

---

### 2.4 Use Case #4: à¹à¸ˆà¹‰à¸‡à¸Šà¸³à¸£à¸°à¹€à¸‡à¸´à¸™à¸­à¸­à¸¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     à¸¥à¸¹à¸à¸„à¹‰à¸²à¹à¸ˆà¹‰à¸‡à¸­à¸­à¸¡                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  A) à¹€à¸›à¸´à¸”à¸­à¸­à¸¡à¹ƒà¸«à¸¡à¹ˆ: "à¸ªà¸™à¹ƒà¸ˆà¸­à¸­à¸¡" + à¸ªà¸´à¸™à¸„à¹‰à¸²               â”‚      â”‚
â”‚  â”‚  B) à¸à¸²à¸à¹€à¸‡à¸´à¸™: "à¹‚à¸­à¸™à¸­à¸­à¸¡" / "à¸à¸²à¸à¸­à¸­à¸¡" + à¸ªà¸¥à¸´à¸›           â”‚      â”‚
â”‚  â”‚  C) à¸ªà¸­à¸šà¸–à¸²à¸¡: "à¸­à¸­à¸¡à¹„à¸›à¹à¸¥à¹‰à¸§à¹€à¸—à¹ˆà¸²à¹„à¸£" / "à¹€à¸«à¸¥à¸·à¸­à¸­à¸µà¸à¹€à¸—à¹ˆà¸²à¹„à¸£"  â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                          â–¼                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚ A) à¹ƒà¸«à¸¡à¹ˆ     â”‚ B) à¸à¸²à¸à¹€à¸‡à¸´à¸™ â”‚ C) à¸–à¸²à¸¡     â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚         â–¼             â–¼             â–¼                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚à¹€à¸à¹‡à¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥  â”‚ â”‚à¹€à¸à¹‡à¸šà¸ªà¸¥à¸´à¸›   â”‚ â”‚à¸”à¸¶à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥   â”‚               â”‚
â”‚  â”‚à¸ªà¸´à¸™à¸„à¹‰à¸²     â”‚ â”‚+à¸¢à¸­à¸”à¸à¸²à¸    â”‚ â”‚à¹à¸ªà¸”à¸‡à¸¢à¸­à¸”    â”‚               â”‚
â”‚  â”‚â†’à¸à¸±à¸™à¸ªà¸´à¸™à¸„à¹‰à¸² â”‚ â”‚â†’à¸ªà¹ˆà¸‡ Admin â”‚ â”‚à¸ªà¸°à¸ªà¸¡       â”‚               â”‚
â”‚  â”‚â†’à¸ªà¹ˆà¸‡ Admin â”‚ â”‚à¸•à¸£à¸§à¸ˆ       â”‚ â”‚           â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                          â–¼                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  à¸«à¸¥à¸±à¸‡ Admin Approve à¸¢à¸­à¸”à¸à¸²à¸:                        â”‚      â”‚
â”‚  â”‚  â†’ à¹à¸ˆà¹‰à¸‡à¸¥à¸¹à¸à¸„à¹‰à¸²: à¸¢à¸­à¸”à¸ªà¸°à¸ªà¸¡ X à¸šà¸²à¸— à¸„à¸‡à¹€à¸«à¸¥à¸·à¸­ Y à¸šà¸²à¸—        â”‚      â”‚
â”‚  â”‚  â†’ à¸–à¹‰à¸²à¸„à¸£à¸šà¸¢à¸­à¸”: à¹à¸ˆà¹‰à¸‡à¸™à¸±à¸”à¸£à¸±à¸šà¸‚à¸­à¸‡/à¸ˆà¸±à¸”à¸ªà¹ˆà¸‡                 â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Required Slots:**
- `action_type`: new | deposit | inquiry
- `savings_id` or `product_ref` or `customer_phone`: à¸£à¸°à¸šà¸¸à¸šà¸±à¸à¸Šà¸µà¸­à¸­à¸¡
- `amount`: à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™à¸—à¸µà¹ˆà¸à¸²à¸
- `slip_image_url`: à¸£à¸¹à¸›à¸ªà¸¥à¸´à¸› (for deposit)

**Intents:**
- `savings_new`: à¹€à¸›à¸´à¸”à¸­à¸­à¸¡à¹ƒà¸«à¸¡à¹ˆ
- `savings_deposit`: à¸à¸²à¸à¹€à¸‡à¸´à¸™à¸­à¸­à¸¡
- `savings_inquiry`: à¸ªà¸­à¸šà¸–à¸²à¸¡à¸¢à¸­à¸”à¸­à¸­à¸¡

---

## 3. Database Schema Analysis

### 3.1 à¸•à¸²à¸£à¸²à¸‡à¸—à¸µà¹ˆà¸¡à¸µà¸­à¸¢à¸¹à¹ˆà¹à¸¥à¹‰à¸§ âœ…

| à¸•à¸²à¸£à¸²à¸‡ | à¸ªà¸–à¸²à¸™à¸° | à¸«à¸¡à¸²à¸¢à¹€à¸«à¸•à¸¸ |
|-------|--------|----------|
| `users` | âœ… à¸¡à¸µ | à¹ƒà¸Šà¹‰à¹€à¸à¹‡à¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸¥à¸¹à¸à¸„à¹‰à¸²à¸—à¸µà¹ˆà¸¥à¸‡à¸—à¸°à¹€à¸šà¸µà¸¢à¸™ |
| `conversations` | âœ… à¸¡à¸µ | à¹€à¸à¹‡à¸š session à¸à¸²à¸£à¸ªà¸™à¸—à¸™à¸² |
| `chat_messages` | âœ… à¸¡à¸µ | à¹€à¸à¹‡à¸šà¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡ (à¸¡à¸µ 2 à¸•à¸²à¸£à¸²à¸‡: commerce + sessions) |
| `chat_sessions` | âœ… à¸¡à¸µ | session à¸ªà¸³à¸«à¸£à¸±à¸š Router (last_intent, last_slots) |
| `chat_events` | âœ… à¸¡à¸µ | events à¸à¸´à¹€à¸¨à¸© |
| `customer_addresses` | âœ… à¸¡à¸µ | à¸—à¸µà¹ˆà¸­à¸¢à¸¹à¹ˆà¸ˆà¸±à¸”à¸ªà¹ˆà¸‡ |
| `orders` | âœ… à¸¡à¸µ | à¸„à¸³à¸ªà¸±à¹ˆà¸‡à¸‹à¸·à¹‰à¸­ (à¸£à¸­à¸‡à¸£à¸±à¸š full/installment) |
| `payments` | âœ… à¸¡à¸µ | à¸à¸²à¸£à¸Šà¸³à¸£à¸°à¹€à¸‡à¸´à¸™ |
| `installment_schedules` | âœ… à¸¡à¸µ | à¸•à¸²à¸£à¸²à¸‡à¸‡à¸§à¸”à¸œà¹ˆà¸­à¸™ |

### 3.2 à¸•à¸²à¸£à¸²à¸‡à¸—à¸µà¹ˆà¸•à¹‰à¸­à¸‡à¹€à¸à¸´à¹ˆà¸¡ âŒ

#### 3.2.1 `cases` - Case/Ticket Management (à¹à¸™à¸°à¸™à¸³à¹€à¸à¸´à¹ˆà¸¡)
```sql
CREATE TABLE cases (
    id INT AUTO_INCREMENT PRIMARY KEY,
    case_no VARCHAR(50) UNIQUE NOT NULL,
    tenant_id VARCHAR(50) NOT NULL DEFAULT 'default',
    
    -- Source
    channel ENUM('facebook', 'line', 'web') NOT NULL,
    platform_user_id VARCHAR(255) NOT NULL,
    conversation_id VARCHAR(100),
    
    -- Case Type
    case_type ENUM('product_search', 'payment_full', 'payment_installment', 'payment_savings', 'general') NOT NULL,
    
    -- Status
    status ENUM('open', 'pending_customer', 'pending_admin', 'approved', 'rejected', 'closed') DEFAULT 'open',
    priority ENUM('low', 'normal', 'high', 'urgent') DEFAULT 'normal',
    
    -- Assignment
    assigned_to INT NULL COMMENT 'FK to admin user',
    locked_at TIMESTAMP NULL,
    
    -- Customer Info (cached)
    customer_name VARCHAR(255),
    customer_phone VARCHAR(50),
    
    -- Product/Order Reference
    product_ref_id VARCHAR(100),
    product_code VARCHAR(100),
    product_name VARCHAR(255),
    order_id INT NULL,
    
    -- Case Data (flexible JSON)
    payload_json JSON COMMENT 'All collected slots and data',
    
    -- Timestamps
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    resolved_at TIMESTAMP NULL,
    
    INDEX idx_case_no (case_no),
    INDEX idx_tenant (tenant_id),
    INDEX idx_channel_user (channel, platform_user_id),
    INDEX idx_status (status),
    INDEX idx_type (case_type),
    INDEX idx_assigned (assigned_to),
    INDEX idx_created_at (created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

#### 3.2.2 `savings_accounts` - à¸šà¸±à¸à¸Šà¸µà¸­à¸­à¸¡à¸ªà¸´à¸™à¸„à¹‰à¸² (à¸•à¹‰à¸­à¸‡à¹€à¸à¸´à¹ˆà¸¡)
```sql
CREATE TABLE savings_accounts (
    id INT AUTO_INCREMENT PRIMARY KEY,
    savings_no VARCHAR(50) UNIQUE NOT NULL,
    tenant_id VARCHAR(50) NOT NULL DEFAULT 'default',
    
    -- Customer
    customer_id INT NULL COMMENT 'FK to users (if registered)',
    platform_user_id VARCHAR(255) NOT NULL,
    channel ENUM('facebook', 'line', 'web') NOT NULL,
    customer_name VARCHAR(255),
    customer_phone VARCHAR(50),
    
    -- Product
    product_ref_id VARCHAR(100),
    product_code VARCHAR(100),
    product_name VARCHAR(255) NOT NULL,
    
    -- Amount
    target_amount DECIMAL(10,2) NOT NULL,
    current_amount DECIMAL(10,2) DEFAULT 0,
    
    -- Terms
    min_deposit_per_time DECIMAL(10,2) DEFAULT 0,
    max_duration_months INT DEFAULT 12,
    started_at DATE NOT NULL,
    deadline_at DATE,
    
    -- Status
    status ENUM('active', 'completed', 'cancelled', 'expired') DEFAULT 'active',
    
    -- Product Reservation
    is_product_reserved TINYINT(1) DEFAULT 1,
    
    -- Linked Order (when completed)
    order_id INT NULL,
    
    -- Timestamps
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    completed_at TIMESTAMP NULL,
    
    FOREIGN KEY (customer_id) REFERENCES users(id) ON DELETE SET NULL,
    INDEX idx_savings_no (savings_no),
    INDEX idx_tenant (tenant_id),
    INDEX idx_platform_user (channel, platform_user_id),
    INDEX idx_status (status),
    INDEX idx_deadline (deadline_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

#### 3.2.3 `savings_transactions` - à¸£à¸²à¸¢à¸à¸²à¸£à¸à¸²à¸à¸­à¸­à¸¡ (à¸•à¹‰à¸­à¸‡à¹€à¸à¸´à¹ˆà¸¡)
```sql
CREATE TABLE savings_transactions (
    id INT AUTO_INCREMENT PRIMARY KEY,
    savings_account_id INT NOT NULL,
    tenant_id VARCHAR(50) NOT NULL DEFAULT 'default',
    
    -- Transaction
    transaction_no VARCHAR(50) UNIQUE NOT NULL,
    amount DECIMAL(10,2) NOT NULL,
    
    -- Payment Info
    slip_image VARCHAR(500),
    payment_method ENUM('bank_transfer', 'promptpay', 'cash') DEFAULT 'bank_transfer',
    paid_at TIMESTAMP NULL,
    
    -- Verification
    status ENUM('pending', 'verified', 'rejected') DEFAULT 'pending',
    verified_by INT NULL,
    verified_at TIMESTAMP NULL,
    rejection_reason TEXT,
    
    -- Metadata
    raw_data_json JSON COMMENT 'OCR data, customer input, etc.',
    
    -- Timestamps
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    FOREIGN KEY (savings_account_id) REFERENCES savings_accounts(id) ON DELETE CASCADE,
    INDEX idx_savings_account (savings_account_id),
    INDEX idx_tenant (tenant_id),
    INDEX idx_status (status),
    INDEX idx_created_at (created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

### 3.3 à¸•à¸²à¸£à¸²à¸‡à¸—à¸µà¹ˆà¸•à¹‰à¸­à¸‡à¹à¸à¹‰à¹„à¸‚ ğŸ”§

#### 3.3.1 `chat_sessions` - à¹€à¸à¸´à¹ˆà¸¡ column à¸ªà¸³à¸«à¸£à¸±à¸š case tracking
```sql
ALTER TABLE chat_sessions
ADD COLUMN active_case_id INT NULL COMMENT 'Current open case for this session',
ADD COLUMN active_case_type VARCHAR(50) NULL,
ADD COLUMN last_admin_message_at TIMESTAMP NULL;
```
*à¸«à¸¡à¸²à¸¢à¹€à¸«à¸•à¸¸: `last_admin_message_at` à¸™à¹ˆà¸²à¸ˆà¸°à¸¡à¸µà¹à¸¥à¹‰à¸§ à¸•à¹‰à¸­à¸‡à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸š*

#### 3.3.2 `orders` - à¹€à¸à¸´à¹ˆà¸¡à¸£à¸­à¸‡à¸£à¸±à¸š "à¸¡à¸±à¸”à¸ˆà¸³" à¹à¸¥à¸° "à¸­à¸­à¸¡"
```sql
ALTER TABLE orders
MODIFY COLUMN payment_type ENUM('full', 'installment', 'deposit', 'savings') NOT NULL,
ADD COLUMN deposit_amount DECIMAL(10,2) DEFAULT 0 COMMENT 'à¸¢à¸­à¸”à¸¡à¸±à¸”à¸ˆà¸³',
ADD COLUMN deposit_percent DECIMAL(5,2) DEFAULT 10.00 COMMENT 'à¹€à¸›à¸­à¸£à¹Œà¹€à¸‹à¹‡à¸™à¸•à¹Œà¸¡à¸±à¸”à¸ˆà¸³',
ADD COLUMN reservation_expires_at TIMESTAMP NULL COMMENT 'à¸§à¸±à¸™à¸«à¸¡à¸”à¸­à¸²à¸¢à¸¸à¸à¸²à¸£à¸ˆà¸­à¸‡';
```

---

## 4. API Specification

### 4.1 APIs à¸—à¸µà¹ˆà¸¡à¸µà¸­à¸¢à¸¹à¹ˆà¹à¸¥à¹‰à¸§ âœ…

| Endpoint | Method | à¸ªà¸–à¸²à¸™à¸° | à¸«à¸¡à¸²à¸¢à¹€à¸«à¸•à¸¸ |
|----------|--------|--------|----------|
| `/api/customer/orders` | GET | âœ… | List orders |
| `/api/customer/orders/{id}` | GET | âœ… | Order detail + installments |
| `/api/customer/payments` | GET | âœ… | List payments |
| `/api/customer/payments/notify` | POST | âœ… | Submit payment (à¸•à¹‰à¸­à¸‡à¸¡à¸µ order_id) |
| `/api/customer/addresses` | CRUD | âœ… | Address management |
| `/api/admin/payments` | GET | âœ… | List + stats |
| `/api/admin/payments/{id}/approve` | PUT | âœ… | Approve payment |
| `/api/admin/payments/{id}/reject` | PUT | âœ… | Reject payment |

### 4.2 APIs à¸—à¸µà¹ˆà¸•à¹‰à¸­à¸‡à¹€à¸à¸´à¹ˆà¸¡ âŒ

#### 4.2.1 Bot/Chat APIs

```
POST /api/bot/cases/create
  - à¸ªà¸£à¹‰à¸²à¸‡ case à¹ƒà¸«à¸¡à¹ˆà¸ˆà¸²à¸ chat
  - Input: platform_user_id, channel, case_type, payload_json
  - Output: case_id, case_no, status

POST /api/bot/cases/{id}/update-slot
  - à¸­à¸±à¸›à¹€à¸”à¸• slot à¹ƒà¸™ case
  - Input: slot_name, slot_value
  - Output: case status, missing_slots

GET /api/bot/cases/{id}
  - à¸”à¸¶à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥ case
  - Output: case detail + collected slots

POST /api/bot/payments/submit
  - Submit payment à¹‚à¸”à¸¢à¹„à¸¡à¹ˆà¸•à¹‰à¸­à¸‡à¸¡à¸µ order_id à¸¥à¹ˆà¸§à¸‡à¸«à¸™à¹‰à¸²
  - à¸ªà¸£à¹‰à¸²à¸‡ "draft order" à¸­à¸±à¸•à¹‚à¸™à¸¡à¸±à¸•à¸´à¸–à¹‰à¸²à¹„à¸¡à¹ˆà¸¡à¸µ
  - Input: platform_user_id, channel, payment_type, amount, slip_image_url, product_ref?, etc.
  - Output: payment_id, case_id, status

POST /api/bot/orders/draft
  - à¸ªà¸£à¹‰à¸²à¸‡ draft order à¸ˆà¸²à¸ chat (à¸à¹ˆà¸­à¸™ payment)
  - Input: platform_user_id, channel, product_ref/product_name, payment_type
  - Output: order_id, order_no
```

#### 4.2.2 Savings APIs

```
POST /api/bot/savings/create
  - à¹€à¸›à¸´à¸”à¸šà¸±à¸à¸Šà¸µà¸­à¸­à¸¡à¹ƒà¸«à¸¡à¹ˆ
  - Input: platform_user_id, channel, product_ref, target_amount, customer_name, customer_phone
  - Output: savings_id, savings_no

POST /api/bot/savings/{id}/deposit
  - à¸à¸²à¸à¹€à¸‡à¸´à¸™à¸­à¸­à¸¡
  - Input: amount, slip_image_url, paid_at
  - Output: transaction_id, current_amount, remaining_amount

GET /api/bot/savings/{id}/status
  - à¸”à¸¶à¸‡à¸ªà¸–à¸²à¸™à¸°à¸šà¸±à¸à¸Šà¸µà¸­à¸­à¸¡
  - Output: target, current, remaining, deadline, is_reserved

GET /api/bot/savings/by-user?platform_user_id=X&channel=Y
  - à¸”à¸¶à¸‡à¸šà¸±à¸à¸Šà¸µà¸­à¸­à¸¡à¸‚à¸­à¸‡ user
  - Output: list of savings accounts

POST /api/admin/savings/{id}/approve-deposit
  - Admin à¸­à¸™à¸¸à¸¡à¸±à¸•à¸´à¸¢à¸­à¸”à¸à¸²à¸

POST /api/admin/savings/{id}/cancel
  - Admin à¸¢à¸à¹€à¸¥à¸´à¸à¸šà¸±à¸à¸Šà¸µà¸­à¸­à¸¡
```

#### 4.2.3 Product Search APIs (à¸•à¸²à¸¡ specapi.json)

```
POST /api/products/search
  - à¸„à¹‰à¸™à¸«à¸²à¸ªà¸´à¸™à¸„à¹‰à¸² (keyword, code, ref_ids)
  - Proxy to NPD API: POST /v1/products/search
  - Input: keyword?, product_code?, ref_ids[]?, filters?
  - Output: products array

POST /api/products/image-search
  - à¸„à¹‰à¸™à¸”à¹‰à¸§à¸¢à¸£à¸¹à¸›à¸ à¸²à¸
  - Step 1: Vector search â†’ get ref_ids
  - Step 2: Call /api/products/search with ref_ids
  - Input: image_url
  - Output: products array
```

#### 4.2.4 Admin Case Management APIs

```
GET /api/admin/cases
  - List all cases with filters
  - Filters: status, type, channel, assigned_to, date_range

GET /api/admin/cases/{id}
  - Case detail + chat history + collected data

PUT /api/admin/cases/{id}/assign
  - Assign case to admin

PUT /api/admin/cases/{id}/resolve
  - Resolve/close case

POST /api/admin/cases/{id}/send-message
  - Send message to customer (via FB/LINE)
```

---

## 5. Bot Profile Design

### 5.1 à¹‚à¸„à¸£à¸‡à¸ªà¸£à¹‰à¸²à¸‡ Bot Profile à¹ƒà¸«à¸¡à¹ˆ (Proposed)

```json
{
  "version": "2.0",
  "persona": {
    "language": "th",
    "tone": "friendly",
    "max_chars": 200,
    "reply_style": "concise_and_helpful"
  },
  "store": {
    "name": "à¹€à¸®à¸‡ à¹€à¸®à¸‡ à¹€à¸®à¸‡",
    "business_type": "secondhand_luxury",
    "description": "à¸£à¹‰à¸²à¸™à¸‚à¸²à¸¢à¸ªà¸´à¸™à¸„à¹‰à¸²à¹à¸šà¸£à¸™à¸”à¹Œà¹€à¸™à¸¡à¸¡à¸·à¸­à¸ªà¸­à¸‡",
    "products": ["à¸™à¸²à¸¬à¸´à¸à¸²", "à¹à¸«à¸§à¸™", "à¸ªà¸£à¹‰à¸­à¸¢à¸„à¸­", "à¸ªà¸£à¹‰à¸­à¸¢à¸‚à¹‰à¸­à¸¡à¸·à¸­", "à¸•à¹ˆà¸²à¸‡à¸«à¸¹", "à¸ˆà¸µà¹‰à¹€à¸à¸Šà¸£", "à¸à¸£à¸°"],
    "warranty_note": "à¸—à¸²à¸‡à¸£à¹‰à¸²à¸™à¸­à¸­à¸à¹ƒà¸šà¸£à¸±à¸šà¸›à¸£à¸°à¸à¸±à¸™à¸ªà¸´à¸™à¸„à¹‰à¸²à¹ƒà¸«à¹‰à¸—à¸¸à¸à¸Šà¸´à¹‰à¸™"
  },
  "case_management": {
    "enabled": true,
    "auto_create_case": true,
    "case_types": ["product_search", "payment_full", "payment_installment", "payment_savings"]
  },
  "routing_policy": {
    "default_router": "case_state_machine",
    "fallback_router": "llm_intent",
    "image_classifier": "vision_first"
  },
  "case_flows": {
    "product_search": {
      "triggers": {
        "intents": ["product_lookup_by_image", "product_lookup_by_code", "product_availability", "price_inquiry"],
        "has_image_without_payment_hint": true,
        "keywords": ["à¸ªà¸™à¹ƒà¸ˆ", "à¸”à¸¹", "à¸¡à¸µà¹„à¸«à¸¡", "à¸£à¸²à¸„à¸²", "à¹€à¸—à¹ˆà¸²à¹„à¸£"]
      },
      "required_slots": ["query_type", "query_value"],
      "optional_slots": ["product_ref_id"],
      "handoff_triggers": ["à¸‹à¸·à¹‰à¸­", "à¸ˆà¹ˆà¸²à¸¢", "à¸Šà¸³à¸£à¸°", "à¸¡à¸±à¸”à¸ˆà¸³", "à¸œà¹ˆà¸­à¸™", "à¸­à¸­à¸¡", "à¸ªà¹ˆà¸§à¸™à¸¥à¸”", "call"]
    },
    "payment_full": {
      "triggers": {
        "intents": ["payment_slip_verify"],
        "has_image_with_payment_hint": true,
        "keywords": ["à¹‚à¸­à¸™à¹à¸¥à¹‰à¸§", "à¸Šà¸³à¸£à¸°à¹à¸¥à¹‰à¸§", "à¸ªà¹ˆà¸‡à¸ªà¸¥à¸´à¸›"]
      },
      "required_slots": ["slip_image_url", "amount"],
      "optional_slots": ["product_ref", "order_no", "payment_time", "sender_name"],
      "auto_extract_from_ocr": ["amount", "payment_time", "sender_name"]
    },
    "payment_installment": {
      "triggers": {
        "intents": ["installment_new", "installment_pay", "installment_extend", "installment_inquiry"],
        "keywords": ["à¸œà¹ˆà¸­à¸™", "à¸‡à¸§à¸”", "à¸•à¹ˆà¸­à¸”à¸­à¸", "à¸Šà¸³à¸£à¸°à¸‡à¸§à¸”"]
      },
      "required_slots": ["action_type"],
      "conditional_slots": {
        "new": ["product_ref", "installment_months"],
        "pay": ["installment_id_or_phone", "period_number", "slip_image_url", "amount"],
        "extend": ["installment_id_or_phone", "slip_image_url", "amount"],
        "inquiry": ["installment_id_or_phone"]
      }
    },
    "payment_savings": {
      "triggers": {
        "intents": ["savings_new", "savings_deposit", "savings_inquiry"],
        "keywords": ["à¸­à¸­à¸¡", "à¸à¸²à¸", "à¸ªà¸°à¸ªà¸¡"]
      },
      "required_slots": ["action_type"],
      "conditional_slots": {
        "new": ["product_ref", "target_amount", "customer_name", "customer_phone"],
        "deposit": ["savings_id_or_phone", "slip_image_url", "amount"],
        "inquiry": ["savings_id_or_phone"]
      }
    }
  },
  "vision_routing": {
    "payment_hints_text_th": ["à¸šà¸²à¸—", "à¸¢à¸­à¸”à¹€à¸‡à¸´à¸™", "à¹‚à¸­à¸™à¹€à¸‡à¸´à¸™", "à¸à¸£à¹‰à¸­à¸¡à¹€à¸à¸¢à¹Œ", "à¸£à¸²à¸¢à¸à¸²à¸£à¸ªà¸³à¹€à¸£à¹‡à¸ˆ", "à¸ªà¹à¸à¸™", "à¹‚à¸­à¸™à¸ªà¸³à¹€à¸£à¹‡à¸ˆ"],
    "payment_hints_text_en": ["THB", "Transfer", "Amount", "Successful", "QR", "Fee"],
    "product_hints_labels": ["watch", "ring", "jewelry", "necklace", "bracelet", "earring", "pendant"]
  },
  "response_templates": {
    "greeting": "à¸ªà¸§à¸±à¸ªà¸”à¸µà¸„à¹ˆà¸° ğŸ˜Š à¸¢à¸´à¸™à¸”à¸µà¸•à¹‰à¸­à¸™à¸£à¸±à¸šà¸„à¹ˆà¸°\nà¸ªà¸™à¹ƒà¸ˆà¸ªà¸´à¸™à¸„à¹‰à¸²à¸­à¸°à¹„à¸£à¸”à¸µà¸„à¸° à¸«à¸£à¸·à¸­à¸•à¹‰à¸­à¸‡à¸à¸²à¸£:\n1ï¸âƒ£ à¸„à¹‰à¸™à¸«à¸²à¸ªà¸´à¸™à¸„à¹‰à¸²\n2ï¸âƒ£ à¹à¸ˆà¹‰à¸‡à¸Šà¸³à¸£à¸°à¹€à¸‡à¸´à¸™\n3ï¸âƒ£ à¸œà¹ˆà¸­à¸™à¸Šà¸³à¸£à¸°\n4ï¸âƒ£ à¸­à¸­à¸¡à¸ªà¸´à¸™à¸„à¹‰à¸²",
    "fallback": "à¸‚à¸­à¸­à¸ à¸±à¸¢à¸„à¹ˆà¸° à¹„à¸¡à¹ˆà¹€à¸‚à¹‰à¸²à¹ƒà¸ˆ ğŸ˜… à¸Šà¹ˆà¸§à¸¢à¸šà¸­à¸à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”à¹€à¸à¸´à¹ˆà¸¡à¹„à¸”à¹‰à¹„à¸«à¸¡à¸„à¸°?",
    "case_created": "à¸£à¸±à¸šà¸—à¸£à¸²à¸šà¸„à¹ˆà¸° âœ… à¸à¸³à¸¥à¸±à¸‡à¸”à¸³à¹€à¸™à¸´à¸™à¸à¸²à¸£ {{case_type}} à¹ƒà¸«à¹‰à¸™à¸°à¸„à¸°",
    "ask_missing_slot": "{{slot_question}}",
    "product_found_one": "à¸à¸šà¸ªà¸´à¸™à¸„à¹‰à¸²à¸„à¹ˆà¸° âœ…\nğŸ“¦ {{name}}\nğŸ·ï¸ à¸£à¸«à¸±à¸ª: {{code}}\nğŸ’° à¸£à¸²à¸„à¸²: {{price}} à¸šà¸²à¸—\nğŸ“‹ à¸ªà¸ à¸²à¸: {{condition}}\n\nà¸ªà¸™à¹ƒà¸ˆà¹„à¸«à¸¡à¸„à¸° ğŸ˜Š",
    "product_found_many": "à¸à¸š {{count}} à¸£à¸²à¸¢à¸à¸²à¸£à¸„à¹ˆà¸° ğŸ˜Š\n{{list}}\nà¸ªà¸™à¹ƒà¸ˆà¸£à¸¸à¹ˆà¸™à¹„à¸«à¸™à¸„à¸°?",
    "product_not_found": "à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¹€à¸ˆà¸­à¹ƒà¸™à¸£à¸°à¸šà¸šà¸„à¹ˆà¸° ğŸ˜… à¸¥à¸­à¸‡à¸ªà¹ˆà¸‡à¸£à¸«à¸±à¸ªà¸«à¸£à¸·à¸­à¸£à¸¹à¸›à¸ªà¸´à¸™à¸„à¹‰à¸²à¹ƒà¸«à¹‰à¸Šà¸±à¸”à¸‚à¸¶à¹‰à¸™à¹„à¸”à¹‰à¹„à¸«à¸¡à¸„à¸°?",
    "payment_received": "à¹„à¸”à¹‰à¸£à¸±à¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸à¸²à¸£à¸Šà¸³à¸£à¸°à¹€à¸‡à¸´à¸™à¹à¸¥à¹‰à¸§à¸„à¹ˆà¸° ğŸ’³\nà¸¢à¸­à¸”: {{amount}} à¸šà¸²à¸—\nà¸£à¸­à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¹‚à¸”à¸¢à¹€à¸ˆà¹‰à¸²à¸«à¸™à¹‰à¸²à¸—à¸µà¹ˆà¸™à¸°à¸„à¸° ğŸ™",
    "payment_approved": "à¸¢à¸·à¸™à¸¢à¸±à¸™à¸à¸²à¸£à¸Šà¸³à¸£à¸°à¹€à¸‡à¸´à¸™à¹à¸¥à¹‰à¸§à¸„à¹ˆà¸° âœ…\nà¸‚à¸­à¸šà¸„à¸¸à¸“à¸¡à¸²à¸à¸™à¸°à¸„à¸° ğŸ™\n{{next_step}}",
    "installment_status": "ğŸ“‹ à¸ªà¸–à¸²à¸™à¸°à¸œà¹ˆà¸­à¸™:\nà¸ªà¸´à¸™à¸„à¹‰à¸²: {{product}}\nà¸ˆà¹ˆà¸²à¸¢à¹à¸¥à¹‰à¸§: {{paid_periods}}/{{total_periods}} à¸‡à¸§à¸”\nà¸‡à¸§à¸”à¸–à¸±à¸”à¹„à¸›: {{next_due_date}}\nà¸¢à¸­à¸”: {{next_amount}} à¸šà¸²à¸—",
    "savings_status": "ğŸ’° à¸ªà¸–à¸²à¸™à¸°à¸­à¸­à¸¡:\nà¸ªà¸´à¸™à¸„à¹‰à¸²: {{product}}\nà¸¢à¸­à¸”à¸ªà¸°à¸ªà¸¡: {{current}} à¸šà¸²à¸—\nà¹€à¸›à¹‰à¸²à¸«à¸¡à¸²à¸¢: {{target}} à¸šà¸²à¸—\nà¸„à¸‡à¹€à¸«à¸¥à¸·à¸­: {{remaining}} à¸šà¸²à¸—",
    "handoff_to_admin": "à¸‚à¸­à¹ƒà¸«à¹‰à¹€à¸ˆà¹‰à¸²à¸«à¸™à¹‰à¸²à¸—à¸µà¹ˆà¸”à¸¹à¹à¸¥à¸•à¹ˆà¸­à¸™à¸°à¸„à¸° ğŸ˜Š à¸£à¸­à¸ªà¸±à¸à¸„à¸£à¸¹à¹ˆà¸„à¹ˆà¸°"
  },
  "slot_questions": {
    "product_ref": "à¸£à¸šà¸à¸§à¸™à¸šà¸­à¸à¸£à¸«à¸±à¸ªà¸ªà¸´à¸™à¸„à¹‰à¸² à¸«à¸£à¸·à¸­à¸ªà¹ˆà¸‡à¸£à¸¹à¸›à¸ªà¸´à¸™à¸„à¹‰à¸²à¸¡à¸²à¹„à¸”à¹‰à¹„à¸«à¸¡à¸„à¸°? ğŸ˜Š",
    "slip_image_url": "à¸£à¸šà¸à¸§à¸™à¸ªà¹ˆà¸‡à¸£à¸¹à¸›à¸ªà¸¥à¸´à¸›à¹‚à¸­à¸™à¹€à¸‡à¸´à¸™à¸¡à¸²à¸”à¹‰à¸§à¸¢à¸™à¸°à¸„à¸° ğŸ’³",
    "amount": "à¸¢à¸­à¸”à¸—à¸µà¹ˆà¹‚à¸­à¸™à¹€à¸—à¹ˆà¸²à¹„à¸£à¸„à¸°?",
    "installment_id_or_phone": "à¸£à¸šà¸à¸§à¸™à¸šà¸­à¸à¹€à¸šà¸­à¸£à¹Œà¹‚à¸—à¸£à¸—à¸µà¹ˆà¸¥à¸‡à¸—à¸°à¹€à¸šà¸µà¸¢à¸™à¸œà¹ˆà¸­à¸™à¹„à¸§à¹‰à¹„à¸”à¹‰à¹„à¸«à¸¡à¸„à¸°?",
    "savings_id_or_phone": "à¸£à¸šà¸à¸§à¸™à¸šà¸­à¸à¹€à¸šà¸­à¸£à¹Œà¹‚à¸—à¸£à¸—à¸µà¹ˆà¸¥à¸‡à¸—à¸°à¹€à¸šà¸µà¸¢à¸™à¸­à¸­à¸¡à¹„à¸§à¹‰à¹„à¸”à¹‰à¹„à¸«à¸¡à¸„à¸°?",
    "customer_name": "à¸‚à¸­à¸—à¸£à¸²à¸šà¸Šà¸·à¹ˆà¸­à¸„à¸¸à¸“à¸¥à¸¹à¸à¸„à¹‰à¸²à¸„à¹ˆà¸°?",
    "customer_phone": "à¸‚à¸­à¹€à¸šà¸­à¸£à¹Œà¹‚à¸—à¸£à¸•à¸´à¸”à¸•à¹ˆà¸­à¸”à¹‰à¸§à¸¢à¸™à¸°à¸„à¸°?"
  },
  "backend_api": {
    "enabled": true,
    "base_url": "https://autobot.boxdesign.in.th",
    "timeout_seconds": 10,
    "endpoints": {
      "product_search": "/api/products/search",
      "image_search": "/api/products/image-search",
      "case_create": "/api/bot/cases/create",
      "case_update": "/api/bot/cases/{id}/update-slot",
      "payment_submit": "/api/bot/payments/submit",
      "savings_create": "/api/bot/savings/create",
      "savings_deposit": "/api/bot/savings/{id}/deposit",
      "savings_status": "/api/bot/savings/{id}/status",
      "installment_status": "/api/bot/installments/{id}/status"
    }
  },
  "external_api": {
    "npd_product_search": {
      "enabled": true,
      "base_url": "https://npd-api.example.com",
      "endpoint": "/v1/products/search",
      "auth_type": "bearer",
      "timeout_seconds": 15
    }
  },
  "llm": {
    "enabled": true,
    "role": "slot_extractor_and_responder",
    "temperature": 0.3,
    "max_tokens": 300,
    "system_prompt": "..."
  }
}
```

---

## 6. Admin Monitor Screens

### 6.1 à¸«à¸™à¹‰à¸²à¸ˆà¸­à¸—à¸µà¹ˆà¸¡à¸µà¸­à¸¢à¸¹à¹ˆà¹à¸¥à¹‰à¸§ âœ…

| à¸«à¸™à¹‰à¸²à¸ˆà¸­ | URL | à¸ªà¸–à¸²à¸™à¸° | à¸«à¸¡à¸²à¸¢à¹€à¸«à¸•à¸¸ |
|--------|-----|--------|----------|
| Payment History | `/payment-history.php` | âœ… | Customer view (à¸•à¹‰à¸­à¸‡à¸—à¸³ admin view) |
| Orders | `/orders.php` | âœ… | Customer view (à¸•à¹‰à¸­à¸‡à¸—à¸³ admin view) |
| Addresses | `/addresses.php` | âœ… | Customer view |

### 6.2 à¸«à¸™à¹‰à¸²à¸ˆà¸­à¸—à¸µà¹ˆà¸•à¹‰à¸­à¸‡à¹€à¸à¸´à¹ˆà¸¡ (Admin Portal) âŒ

#### 6.2.1 `/admin/cases.php` - Case Inbox (à¸ªà¸³à¸„à¸±à¸à¸¡à¸²à¸!)
- **à¸Ÿà¸µà¹€à¸ˆà¸­à¸£à¹Œ:**
  - Queue/Inbox à¸£à¸§à¸¡à¸—à¸¸à¸à¸Šà¹ˆà¸­à¸‡à¸—à¸²à¸‡ (FB + LINE)
  - Filter: case_type, status, channel, assigned_to, date
  - à¹à¸ªà¸”à¸‡: case_no, à¸¥à¸¹à¸à¸„à¹‰à¸², à¸›à¸£à¸°à¹€à¸ à¸—, à¸ªà¸–à¸²à¸™à¸°, à¹€à¸§à¸¥à¸², owner
  - Actions: à¹€à¸›à¸´à¸”à¸”à¸¹, à¸£à¸±à¸šà¹€à¸„à¸ª, à¸ªà¹ˆà¸‡à¸•à¹ˆà¸­, à¸›à¸´à¸”à¹€à¸„à¸ª
- **Side Panel:**
  - Chat transcript
  - Collected slots
  - Actions (approve/reject/send message)

#### 6.2.2 `/admin/payments.php` - Payment Verification Queue
- **à¸Ÿà¸µà¹€à¸ˆà¸­à¸£à¹Œ:**
  - List payments: pending â†’ verifying â†’ verified/rejected
  - Filter: payment_type (full/installment/savings), status, date
  - Quick view: à¸ªà¸¥à¸´à¸›, à¸¢à¸­à¸”, à¸ªà¸´à¸™à¸„à¹‰à¸², à¸¥à¸¹à¸à¸„à¹‰à¸²
  - Actions: Approve, Reject (+ reason), Send message

#### 6.2.3 `/admin/installments.php` - Installment Dashboard
- **à¸Ÿà¸µà¹€à¸ˆà¸­à¸£à¹Œ:**
  - à¸£à¸²à¸¢à¸à¸²à¸£à¸œà¹ˆà¸­à¸™à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”
  - Filter: status, overdue, customer
  - à¹à¸ªà¸”à¸‡: à¸¥à¸¹à¸à¸„à¹‰à¸², à¸ªà¸´à¸™à¸„à¹‰à¸², à¸‡à¸§à¸”à¸—à¸µà¹ˆà¸ˆà¹ˆà¸²à¸¢/à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”, à¸‡à¸§à¸”à¸–à¸±à¸”à¹„à¸›, à¸ªà¸–à¸²à¸™à¸°
  - Actions: à¸”à¸¹à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”, à¸ªà¹ˆà¸‡à¹€à¸•à¸·à¸­à¸™, à¸­à¸™à¸¸à¸¡à¸±à¸•à¸´à¸•à¹ˆà¸­à¸”à¸­à¸

#### 6.2.4 `/admin/savings.php` - Savings Dashboard
- **à¸Ÿà¸µà¹€à¸ˆà¸­à¸£à¹Œ:**
  - à¸£à¸²à¸¢à¸à¸²à¸£à¸­à¸­à¸¡à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”
  - Filter: status, deadline, customer
  - à¹à¸ªà¸”à¸‡: à¸¥à¸¹à¸à¸„à¹‰à¸², à¸ªà¸´à¸™à¸„à¹‰à¸², à¸¢à¸­à¸”à¸ªà¸°à¸ªà¸¡/à¹€à¸›à¹‰à¸²à¸«à¸¡à¸²à¸¢, deadline
  - Actions: à¸”à¸¹à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”, à¸­à¸™à¸¸à¸¡à¸±à¸•à¸´à¸¢à¸­à¸”à¸à¸²à¸, à¸¢à¸à¹€à¸¥à¸´à¸

#### 6.2.5 `/admin/products.php` - Product Lookup (Helper)
- **à¸Ÿà¸µà¹€à¸ˆà¸­à¸£à¹Œ:**
  - à¸„à¹‰à¸™à¸«à¸²à¸ªà¸´à¸™à¸„à¹‰à¸²à¸ˆà¸²à¸ NPD
  - à¸ªà¹ˆà¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ªà¸´à¸™à¸„à¹‰à¸²à¹ƒà¸«à¹‰à¸¥à¸¹à¸à¸„à¹‰à¸²à¸œà¹ˆà¸²à¸™ chat
  - à¸”à¸¹à¸ªà¸–à¸²à¸™à¸°à¸ªà¸´à¸™à¸„à¹‰à¸² (in_stock/reserved/sold)

---

## 7. Implementation Checklist

### ğŸ“‹ Phase 1: Database & Foundation (Priority: Critical)

- [ ] **1.1** à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸š schema à¸›à¸±à¸ˆà¸ˆà¸¸à¸šà¸±à¸™à¹ƒà¸™ production
  - [ ] à¸•à¸²à¸£à¸²à¸‡ `orders` à¸¡à¸µ field à¸„à¸£à¸šà¹„à¸«à¸¡
  - [ ] à¸•à¸²à¸£à¸²à¸‡ `payments` à¸¡à¸µ field à¸„à¸£à¸šà¹„à¸«à¸¡
  - [ ] à¸•à¸²à¸£à¸²à¸‡ `installment_schedules` à¸¡à¸µ field à¸„à¸£à¸šà¹„à¸«à¸¡
  - [ ] à¸•à¸²à¸£à¸²à¸‡ `chat_sessions` à¸¡à¸µ `last_admin_message_at` à¹„à¸«à¸¡

- [ ] **1.2** à¸ªà¸£à¹‰à¸²à¸‡à¸•à¸²à¸£à¸²à¸‡ `cases`
  - [ ] à¹€à¸‚à¸µà¸¢à¸™ migration SQL
  - [ ] Run migration à¸šà¸™ local
  - [ ] Test à¸šà¸™ local
  - [ ] Deploy à¸šà¸™ production

- [ ] **1.3** à¸ªà¸£à¹‰à¸²à¸‡à¸•à¸²à¸£à¸²à¸‡ `savings_accounts` + `savings_transactions`
  - [ ] à¹€à¸‚à¸µà¸¢à¸™ migration SQL
  - [ ] Run migration à¸šà¸™ local
  - [ ] Test à¸šà¸™ local
  - [ ] Deploy à¸šà¸™ production

- [ ] **1.4** à¹à¸à¹‰à¹„à¸‚à¸•à¸²à¸£à¸²à¸‡ `orders` (à¹€à¸à¸´à¹ˆà¸¡ deposit/savings support)
  - [ ] à¹€à¸‚à¸µà¸¢à¸™ ALTER TABLE
  - [ ] Test à¹„à¸¡à¹ˆà¸à¸£à¸°à¸—à¸š data à¹€à¸”à¸´à¸¡
  - [ ] Deploy à¸šà¸™ production

### ğŸ“‹ Phase 2: Bot APIs (Priority: High)

- [ ] **2.1** `/api/bot/cases/create`
- [ ] **2.2** `/api/bot/cases/{id}/update-slot`
- [ ] **2.3** `/api/bot/cases/{id}` (GET)
- [ ] **2.4** `/api/bot/payments/submit` (à¹„à¸¡à¹ˆà¸•à¹‰à¸­à¸‡à¸¡à¸µ order_id)
- [ ] **2.5** `/api/bot/orders/draft`
- [ ] **2.6** `/api/bot/savings/create`
- [ ] **2.7** `/api/bot/savings/{id}/deposit`
- [ ] **2.8** `/api/bot/savings/{id}/status`
- [ ] **2.9** `/api/bot/savings/by-user`
- [ ] **2.10** `/api/products/search` (proxy to NPD)
- [ ] **2.11** `/api/products/image-search` (vector + NPD)

### ğŸ“‹ Phase 3: Admin APIs (Priority: High)

- [ ] **3.1** `/api/admin/cases` (list + filters)
- [ ] **3.2** `/api/admin/cases/{id}` (detail)
- [ ] **3.3** `/api/admin/cases/{id}/assign`
- [ ] **3.4** `/api/admin/cases/{id}/resolve`
- [ ] **3.5** `/api/admin/cases/{id}/send-message`
- [ ] **3.6** `/api/admin/savings` (list + filters)
- [ ] **3.7** `/api/admin/savings/{id}/approve-deposit`
- [ ] **3.8** `/api/admin/savings/{id}/cancel`

### ğŸ“‹ Phase 4: Bot Profile & Router (Priority: High)

- [ ] **4.1** à¸­à¸±à¸›à¹€à¸”à¸• `bot_profile_config_generic.json` (à¸•à¸²à¸¡ Section 5)
- [ ] **4.2** à¹à¸à¹‰à¹„à¸‚ `RouterV1Handler.php`:
  - [ ] à¹€à¸à¸´à¹ˆà¸¡ Case Engine (state machine)
  - [ ] à¹€à¸à¸´à¹ˆà¸¡ logic à¹à¸¢à¸ 4 use cases
  - [ ] à¹€à¸à¸´à¹ˆà¸¡ slot filling loop
  - [ ] à¹€à¸à¸´à¹ˆà¸¡à¹€à¸£à¸µà¸¢à¸ API à¹ƒà¸«à¸¡à¹ˆ

- [ ] **4.3** à¸—à¸”à¸ªà¸­à¸š Router à¸à¸±à¸š 4 use cases:
  - [ ] Test: à¸ªà¹ˆà¸‡à¸£à¸¹à¸›à¸ªà¸´à¸™à¸„à¹‰à¸² â†’ product search
  - [ ] Test: à¸ªà¹ˆà¸‡à¸£à¸¹à¸›à¸ªà¸¥à¸´à¸› â†’ payment
  - [ ] Test: à¸à¸´à¸¡à¸à¹Œ "à¸œà¹ˆà¸­à¸™" â†’ installment
  - [ ] Test: à¸à¸´à¸¡à¸à¹Œ "à¸­à¸­à¸¡" â†’ savings

### ğŸ“‹ Phase 5: Admin Screens (Priority: Medium)

- [ ] **5.1** `/admin/cases.php` - Case Inbox
- [ ] **5.2** `/admin/payments.php` - Admin version
- [ ] **5.3** `/admin/installments.php` - Dashboard
- [ ] **5.4** `/admin/savings.php` - Dashboard
- [ ] **5.5** `/admin/products.php` - Product lookup

### ğŸ“‹ Phase 6: Integration & Testing (Priority: High)

- [ ] **6.1** Integrate NPD Product Search API
- [ ] **6.2** Implement Vector Search for images
- [ ] **6.3** Test FB + LINE (both channels)
- [ ] **6.4** End-to-end test: 4 use cases Ã— 2 channels

---

## 8. Test Cases

### 8.1 Use Case #1: Product Search

| Test ID | Scenario | Input | Expected Output |
|---------|----------|-------|-----------------|
| PS-01 | à¸ªà¹ˆà¸‡à¸£à¸¹à¸›à¸ªà¸´à¸™à¸„à¹‰à¸² | à¸£à¸¹à¸›à¸™à¸²à¸¬à¸´à¸à¸² Rolex | à¹à¸ªà¸”à¸‡à¸œà¸¥à¸ªà¸´à¸™à¸„à¹‰à¸²à¸—à¸µà¹ˆ match |
| PS-02 | à¸à¸´à¸¡à¸à¹Œ keyword | "Rolex Datejust" | à¹à¸ªà¸”à¸‡à¸œà¸¥à¸ªà¸´à¸™à¸„à¹‰à¸²à¸—à¸µà¹ˆ match |
| PS-03 | à¸ªà¹ˆà¸‡à¸£à¸«à¸±à¸ªà¸ªà¸´à¸™à¸„à¹‰à¸² | "SKU-12345" | à¹à¸ªà¸”à¸‡à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”à¸ªà¸´à¸™à¸„à¹‰à¸² |
| PS-04 | à¹„à¸¡à¹ˆà¹€à¸ˆà¸­à¸ªà¸´à¸™à¸„à¹‰à¸² | à¸£à¸¹à¸›/keyword à¹„à¸¡à¹ˆ match | à¹à¸ˆà¹‰à¸‡à¹„à¸¡à¹ˆà¹€à¸ˆà¸­ + à¸‚à¸­à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹€à¸à¸´à¹ˆà¸¡ |
| PS-05 | à¸–à¸²à¸¡à¸£à¸²à¸„à¸²à¸‹à¹‰à¸³ | "à¸£à¸²à¸„à¸²à¹€à¸—à¹ˆà¸²à¹„à¸£" (à¸«à¸¥à¸±à¸‡à¸šà¸­à¸à¹à¸¥à¹‰à¸§) | à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡à¸£à¸²à¸„à¸²à¹€à¸”à¸´à¸¡ à¹„à¸¡à¹ˆ call API à¸‹à¹‰à¸³ |

### 8.2 Use Case #2: Payment Full

| Test ID | Scenario | Input | Expected Output |
|---------|----------|-------|-----------------|
| PF-01 | à¸ªà¹ˆà¸‡à¸ªà¸¥à¸´à¸›à¸à¸£à¹‰à¸­à¸¡ text | à¸£à¸¹à¸›à¸ªà¸¥à¸´à¸› + "à¹‚à¸­à¸™à¹à¸¥à¹‰à¸§" | OCR â†’ à¸šà¸±à¸™à¸—à¸¶à¸ â†’ pending |
| PF-02 | à¸ªà¹ˆà¸‡à¸ªà¸¥à¸´à¸›à¹€à¸‰à¸¢à¹† | à¸£à¸¹à¸›à¸ªà¸¥à¸´à¸› | à¸•à¸£à¸§à¸ˆà¹€à¸›à¹‡à¸™à¸ªà¸¥à¸´à¸› â†’ à¸–à¸²à¸¡à¸¢à¸·à¸™à¸¢à¸±à¸™ |
| PF-03 | OCR à¹„à¸¡à¹ˆà¸Šà¸±à¸” | à¸£à¸¹à¸›à¸ªà¸¥à¸´à¸›à¹€à¸šà¸¥à¸­ | à¸–à¸²à¸¡à¸¢à¸­à¸”à¹€à¸‡à¸´à¸™à¸ˆà¸²à¸ user |
| PF-04 | à¹„à¸¡à¹ˆà¸£à¸¹à¹‰à¸ªà¸´à¸™à¸„à¹‰à¸² | à¸ªà¸¥à¸´à¸› + à¹„à¸¡à¹ˆà¸¡à¸µ order ref | à¸–à¸²à¸¡à¸ªà¸´à¸™à¸„à¹‰à¸²à¸—à¸µà¹ˆà¸Šà¸³à¸£à¸° |

### 8.3 Use Case #3: Installment

| Test ID | Scenario | Input | Expected Output |
|---------|----------|-------|-----------------|
| IN-01 | à¹€à¸›à¸´à¸”à¸œà¹ˆà¸­à¸™à¹ƒà¸«à¸¡à¹ˆ | "à¸ªà¸™à¹ƒà¸ˆà¸œà¹ˆà¸­à¸™" + à¸ªà¸´à¸™à¸„à¹‰à¸² | à¹€à¸à¹‡à¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥ â†’ à¸ªà¹ˆà¸‡ admin |
| IN-02 | à¸ˆà¹ˆà¸²à¸¢à¸‡à¸§à¸” | "à¸Šà¸³à¸£à¸°à¸‡à¸§à¸”" + à¸ªà¸¥à¸´à¸› | à¸šà¸±à¸™à¸—à¸¶à¸ â†’ à¹à¸ˆà¹‰à¸‡à¸‡à¸§à¸”à¸–à¸±à¸”à¹„à¸› |
| IN-03 | à¸•à¹ˆà¸­à¸”à¸­à¸ | "à¸•à¹ˆà¸­à¸”à¸­à¸" + à¸ªà¸¥à¸´à¸› | à¸šà¸±à¸™à¸—à¸¶à¸ â†’ à¸£à¸­ admin |
| IN-04 | à¸ªà¸­à¸šà¸–à¸²à¸¡à¸¢à¸­à¸” | "à¹€à¸«à¸¥à¸·à¸­à¸à¸µà¹ˆà¸‡à¸§à¸”" | à¹à¸ªà¸”à¸‡à¸•à¸²à¸£à¸²à¸‡à¸œà¹ˆà¸­à¸™ |
| IN-05 | à¸ˆà¹ˆà¸²à¸¢à¸„à¸£à¸š | à¸Šà¸³à¸£à¸°à¸‡à¸§à¸”à¸ªà¸¸à¸”à¸—à¹‰à¸²à¸¢ | à¹à¸ˆà¹‰à¸‡à¸„à¸£à¸š â†’ à¸™à¸±à¸”à¸£à¸±à¸šà¸‚à¸­à¸‡ |

### 8.4 Use Case #4: Savings

| Test ID | Scenario | Input | Expected Output |
|---------|----------|-------|-----------------|
| SV-01 | à¹€à¸›à¸´à¸”à¸­à¸­à¸¡à¹ƒà¸«à¸¡à¹ˆ | "à¸ªà¸™à¹ƒà¸ˆà¸­à¸­à¸¡" + à¸ªà¸´à¸™à¸„à¹‰à¸² | à¹€à¸à¹‡à¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥ â†’ à¸à¸±à¸™à¸ªà¸´à¸™à¸„à¹‰à¸² |
| SV-02 | à¸à¸²à¸à¹€à¸‡à¸´à¸™ | "à¹‚à¸­à¸™à¸­à¸­à¸¡" + à¸ªà¸¥à¸´à¸› | à¸šà¸±à¸™à¸—à¸¶à¸ â†’ à¹à¸ªà¸”à¸‡à¸¢à¸­à¸”à¸ªà¸°à¸ªà¸¡ |
| SV-03 | à¸ªà¸­à¸šà¸–à¸²à¸¡à¸¢à¸­à¸” | "à¸­à¸­à¸¡à¹„à¸›à¹à¸¥à¹‰à¸§à¹€à¸—à¹ˆà¸²à¹„à¸£" | à¹à¸ªà¸”à¸‡à¸¢à¸­à¸”à¸ªà¸°à¸ªà¸¡ + à¸„à¸‡à¹€à¸«à¸¥à¸·à¸­ |
| SV-04 | à¸­à¸­à¸¡à¸„à¸£à¸š | à¸à¸²à¸à¸ˆà¸™à¸„à¸£à¸šà¹€à¸›à¹‰à¸² | à¹à¸ˆà¹‰à¸‡à¸„à¸£à¸š â†’ à¸™à¸±à¸”à¸£à¸±à¸šà¸‚à¸­à¸‡ |

### 8.5 Edge Cases

| Test ID | Scenario | Input | Expected Output |
|---------|----------|-------|-----------------|
| EC-01 | à¸ªà¹ˆà¸‡à¸£à¸¹à¸›à¸ªà¸´à¸™à¸„à¹‰à¸² + à¸à¸´à¸¡à¸à¹Œ "à¹‚à¸­à¸™" | à¸£à¸¹à¸›à¸™à¸²à¸¬à¸´à¸à¸² + "à¹‚à¸­à¸™à¹à¸¥à¹‰à¸§" | à¸–à¸²à¸¡à¸§à¹ˆà¸²à¹€à¸›à¹‡à¸™à¸ªà¸¥à¸´à¸›à¸«à¸£à¸·à¸­à¸ªà¸´à¸™à¸„à¹‰à¸² |
| EC-02 | à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¹€à¸£à¸·à¹ˆà¸­à¸‡à¸à¸¥à¸²à¸‡à¸„à¸±à¸™ | à¸„à¸¸à¸¢à¸œà¹ˆà¸­à¸™ â†’ à¸–à¸²à¸¡à¸ªà¸´à¸™à¸„à¹‰à¸²à¸­à¸·à¹ˆà¸™ | à¸ˆà¸±à¸”à¸à¸²à¸£ context switch |
| EC-03 | Admin à¹€à¸‚à¹‰à¸²à¸¡à¸²à¸•à¸­à¸š | Admin à¸à¸´à¸¡à¸à¹Œ | Bot à¸«à¸¢à¸¸à¸” 1 à¸Šà¸¡. |
| EC-04 | Spam | à¸ªà¹ˆà¸‡à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸‹à¹‰à¸³ 3 à¸„à¸£à¸±à¹‰à¸‡ | Anti-spam response |

---

## 9. à¸„à¸³à¸–à¸²à¸¡à¹à¸¥à¸°à¸„à¸³à¸•à¸­à¸šà¸ˆà¸²à¸à¸—à¸µà¸¡ Sales

### âœ… Critical (à¹„à¸”à¹‰à¸„à¸³à¸•à¸­à¸šà¹à¸¥à¹‰à¸§)

| # | à¸„à¸³à¸–à¸²à¸¡ | à¸„à¸³à¸•à¸­à¸š | à¸œà¸¥à¸à¸£à¸°à¸—à¸šà¸•à¹ˆà¸­à¸£à¸°à¸šà¸š |
|---|-------|-------|----------------|
| 1 | **à¸­à¸­à¸¡ = à¸à¸±à¸™à¸ªà¸´à¸™à¸„à¹‰à¸²à¹„à¸§à¹‰à¸£à¸°à¸«à¸§à¹ˆà¸²à¸‡à¸­à¸­à¸¡à¹ƒà¸Šà¹ˆà¹„à¸«à¸¡?** | âœ… à¹ƒà¸Šà¹ˆ à¸—à¸³à¸¡à¸²à¸•à¸£à¸à¸²à¸™à¸—à¸±à¹ˆà¸§à¹„à¸›à¸à¹ˆà¸­à¸™ | à¸ªà¸£à¹‰à¸²à¸‡ `savings_accounts` à¸à¸£à¹‰à¸­à¸¡ `is_product_reserved = 1` |
| 2 | **à¸¥à¸¹à¸à¸„à¹‰à¸²à¸ªà¹ˆà¸‡à¸ªà¸¥à¸´à¸›à¸¡à¸²à¸¡à¸µ order ref à¹„à¸«à¸¡?** | âŒ à¸ªà¹ˆà¸§à¸™à¹ƒà¸«à¸à¹ˆà¹„à¸¡à¹ˆà¸¡à¸µ | à¸£à¸°à¸šà¸šà¸•à¹‰à¸­à¸‡à¸ªà¸£à¹‰à¸²à¸‡ draft order à¸­à¸±à¸•à¹‚à¸™à¸¡à¸±à¸•à¸´ |
| 3 | **à¸ªà¸£à¹‰à¸²à¸‡ order draft à¸­à¸±à¸•à¹‚à¸™à¸¡à¸±à¸•à¸´à¹„à¸”à¹‰à¹„à¸«à¸¡?** | âœ… à¹„à¸”à¹‰ (à¸ªà¸´à¸™à¸„à¹‰à¸²à¸Šà¸´à¹‰à¸™à¹€à¸”à¸µà¸¢à¸§ à¸«à¸¡à¸¸à¸™à¹€à¸§à¸µà¸¢à¸™à¹„à¸”à¹‰) | à¹€à¸à¸´à¹ˆà¸¡ `/api/bot/orders/draft` |
| 4 | **NPD à¹ƒà¸Šà¹‰ key à¸­à¸°à¹„à¸£?** | âœ… `ref_id` | à¹ƒà¸Šà¹‰ `ref_id` à¹€à¸›à¹‡à¸™ primary key à¸—à¸¸à¸à¸—à¸µà¹ˆ |
| 5 | **Admin monitor à¸£à¸§à¸¡ FB+LINE?** | âœ… à¸£à¸§à¸¡à¸«à¸™à¹‰à¸²à¹€à¸”à¸µà¸¢à¸§ à¸¡à¸µ column à¹à¸¢à¸à¸Šà¹ˆà¸­à¸‡à¸—à¸²à¸‡ | Case Inbox à¸£à¸§à¸¡ + filter by channel |

### ğŸŸ¡ Important (à¸£à¸­à¸„à¸³à¸•à¸­à¸š)

6. **à¹€à¸‡à¸·à¹ˆà¸­à¸™à¹„à¸‚à¸œà¹ˆà¸­à¸™:** à¸à¸µà¹ˆà¸‡à¸§à¸”? à¸”à¸²à¸§à¸™à¹Œà¹€à¸—à¹ˆà¸²à¹„à¸£? à¸”à¸­à¸à¹€à¸šà¸µà¹‰à¸¢à¸„à¸´à¸”à¸¢à¸±à¸‡à¹„à¸‡?

7. **à¹€à¸‡à¸·à¹ˆà¸­à¸™à¹„à¸‚à¸­à¸­à¸¡:** à¸‚à¸±à¹‰à¸™à¸•à¹ˆà¸³à¸•à¹ˆà¸­à¸„à¸£à¸±à¹‰à¸‡? à¸£à¸°à¸¢à¸°à¹€à¸§à¸¥à¸²à¸ªà¸¹à¸‡à¸ªà¸¸à¸”? à¸–à¹‰à¸²à¸«à¸¢à¸¸à¸”à¸­à¸­à¸¡à¸„à¸·à¸™à¹€à¸‡à¸´à¸™à¹„à¸«à¸¡?

8. **à¸Šà¹ˆà¸­à¸‡à¸—à¸²à¸‡à¸£à¸±à¸šà¹€à¸‡à¸´à¸™:** à¸šà¸±à¸à¸Šà¸µà¸˜à¸™à¸²à¸„à¸²à¸£/QR à¸à¸£à¹‰à¸­à¸¡à¹€à¸à¸¢à¹Œà¸—à¸µà¹ˆà¹ƒà¸Šà¹‰?

9. **à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸¡à¸²à¸•à¸£à¸à¸²à¸™:** à¹€à¸¥à¸‚à¸šà¸±à¸à¸Šà¸µ, à¹€à¸‡à¸·à¹ˆà¸­à¸™à¹„à¸‚à¸œà¹ˆà¸­à¸™/à¸­à¸­à¸¡, à¸§à¸´à¸˜à¸µà¸ˆà¸±à¸”à¸ªà¹ˆà¸‡?

10. **à¸à¸•à¸´à¸à¸²à¸£à¹‰à¸²à¸™:** à¸„à¸·à¸™à¹€à¸‡à¸´à¸™/à¸œà¸´à¸”à¸™à¸±à¸”/à¸à¸±à¸™à¸ªà¸´à¸™à¸„à¹‰à¸²/à¸„à¹ˆà¸²à¸›à¸£à¸±à¸š?

---

## 10. ğŸ”´ Admin Handoff Mechanism

### 10.1 Handoff Triggers

- **Product Search:** à¹€à¸¡à¸·à¹ˆà¸­à¹€à¸ˆà¸­à¸ªà¸´à¸™à¸„à¹‰à¸²à¸—à¸µà¹ˆà¸¥à¸¹à¸à¸„à¹‰à¸²à¸ªà¸™à¹ƒà¸ˆ
- **Payment Full:** à¹€à¸¡à¸·à¹ˆà¸­à¹„à¸”à¹‰à¸£à¸±à¸šà¸ªà¸¥à¸´à¸›à¹‚à¸­à¸™à¹€à¸‡à¸´à¸™
- **Installment:** à¹€à¸¡à¸·à¹ˆà¸­à¸¡à¸µà¸à¸²à¸£à¸ˆà¹ˆà¸²à¸¢à¸‡à¸§à¸”à¸«à¸£à¸·à¸­à¸•à¹ˆà¸­à¸”à¸­à¸
- **Savings:** à¹€à¸¡à¸·à¹ˆà¸­à¸¡à¸µà¸à¸²à¸£à¸à¸²à¸à¹€à¸‡à¸´à¸™à¸­à¸­à¸¡

### 10.2 Handoff Process

1. **Bot à¹à¸ˆà¹‰à¸‡à¹€à¸•à¸·à¸­à¸™ Admin:** à¸ªà¹ˆà¸‡ notification à¹„à¸›à¸¢à¸±à¸‡ admin dashboard
2. **Admin à¸£à¸±à¸šà¹€à¸„à¸ª:** Admin à¸ªà¸²à¸¡à¸²à¸£à¸–à¸£à¸±à¸šà¹€à¸„à¸ªà¹à¸¥à¸°à¸•à¸­à¸šà¸¥à¸¹à¸à¸„à¹‰à¸²à¹„à¸”à¹‰à¸—à¸±à¸™à¸—à¸µ
3. **Bot à¸«à¸¢à¸¸à¸”à¸•à¸­à¸š:** Bot à¸ˆà¸°à¸«à¸¢à¸¸à¸”à¸•à¸­à¸šà¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¹ƒà¸™à¹€à¸„à¸ªà¸™à¸±à¹‰à¸™à¹† à¹€à¸›à¹‡à¸™à¹€à¸§à¸¥à¸² 1 à¸Šà¸±à¹ˆà¸§à¹‚à¸¡à¸‡
4. **Admin à¸•à¸­à¸šà¸¥à¸¹à¸à¸„à¹‰à¸²:** Admin à¸ªà¸²à¸¡à¸²à¸£à¸–à¸•à¸­à¸šà¸¥à¸¹à¸à¸„à¹‰à¸²à¹à¸¥à¸°à¸”à¸³à¹€à¸™à¸´à¸™à¸à¸²à¸£à¸•à¹ˆà¸­à¹„à¸”à¹‰
5. **Bot à¸à¸¥à¸±à¸šà¸¡à¸²à¸—à¸³à¸‡à¸²à¸™:** à¸–à¹‰à¸² Admin à¹„à¸¡à¹ˆà¸•à¸­à¸šà¸ à¸²à¸¢à¹ƒà¸™ 1 à¸Šà¸±à¹ˆà¸§à¹‚à¸¡à¸‡ Bot à¸ˆà¸°à¸à¸¥à¸±à¸šà¸¡à¸²à¸—à¸³à¸‡à¸²à¸™à¸•à¹ˆà¸­

### 10.3 Handoff Scenarios

- **Product Inquiry:** à¸¥à¸¹à¸à¸„à¹‰à¸²à¸ªà¸™à¹ƒà¸ˆà¸ªà¸´à¸™à¸„à¹‰à¸²à¸Šà¸´à¹‰à¸™à¹ƒà¸”à¸Šà¸´à¹‰à¸™à¸«à¸™à¸¶à¹ˆà¸‡
- **Payment Confirmation:** à¸¥à¸¹à¸à¸„à¹‰à¸²à¸ªà¹ˆà¸‡à¸ªà¸¥à¸´à¸›à¹‚à¸­à¸™à¹€à¸‡à¸´à¸™
- **Installment Payment:** à¸¥à¸¹à¸à¸„à¹‰à¸²à¸ˆà¹ˆà¸²à¸¢à¸‡à¸§à¸”à¸œà¹ˆà¸­à¸™
- **Savings Deposit:** à¸¥à¸¹à¸à¸„à¹‰à¸²à¸à¸²à¸à¹€à¸‡à¸´à¸™à¸­à¸­à¸¡

---

## 11. ğŸ”´ Image Classification Logic

### 11.1 Image Classification Steps

1. **Receive Image:** à¸£à¸±à¸šà¸£à¸¹à¸›à¸ à¸²à¸à¸ˆà¸²à¸à¸¥à¸¹à¸à¸„à¹‰à¸²
2. **Preprocess Image:** à¸›à¸£à¸±à¸šà¸‚à¸™à¸²à¸”à¹à¸¥à¸°à¸£à¸¹à¸›à¹à¸šà¸šà¸‚à¸­à¸‡à¸ à¸²à¸à¹ƒà¸«à¹‰à¹€à¸«à¸¡à¸²à¸°à¸ªà¸¡
3. **Classify Image:** à¹ƒà¸Šà¹‰ model à¹ƒà¸™à¸à¸²à¸£à¸ˆà¸³à¹à¸™à¸à¸›à¸£à¸°à¹€à¸ à¸—à¸‚à¸­à¸‡à¸ à¸²à¸
4. **Extract Features:** à¸”à¸¶à¸‡ features à¸ˆà¸²à¸à¸ à¸²à¸à¹€à¸à¸·à¹ˆà¸­à¹ƒà¸Šà¹‰à¹ƒà¸™à¸à¸²à¸£à¸„à¹‰à¸™à¸«à¸²
5. **Search Database:** à¸„à¹‰à¸™à¸«à¸²à¸ªà¸´à¸™à¸„à¹‰à¸²à¸—à¸µà¹ˆà¸¡à¸µ features à¹ƒà¸à¸¥à¹‰à¹€à¸„à¸µà¸¢à¸‡à¹ƒà¸™à¸à¸²à¸™à¸‚à¹‰à¸­à¸¡à¸¹à¸¥
6. **Return Results:** à¸ªà¹ˆà¸‡à¸œà¸¥à¸¥à¸±à¸à¸˜à¹Œà¸à¸²à¸£à¸„à¹‰à¸™à¸«à¸²à¸à¸¥à¸±à¸šà¹„à¸›à¸¢à¸±à¸‡à¸¥à¸¹à¸à¸„à¹‰à¸²

### 11.2 Image Classification Model

- **Model Type:** Convolutional Neural Network (CNN)
- **Training Data:** à¸£à¸¹à¸›à¸ à¸²à¸à¸ªà¸´à¸™à¸„à¹‰à¸²à¸ˆà¸²à¸à¸à¸²à¸™à¸‚à¹‰à¸­à¸¡à¸¹à¸¥ NPD
- **Output Labels:** à¸›à¸£à¸°à¹€à¸ à¸—à¸ªà¸´à¸™à¸„à¹‰à¸² à¹€à¸Šà¹ˆà¸™ à¸™à¸²à¸¬à¸´à¸à¸², à¹à¸«à¸§à¸™, à¸ªà¸£à¹‰à¸­à¸¢à¸„à¸­, à¸ªà¸£à¹‰à¸­à¸¢à¸‚à¹‰à¸­à¸¡à¸·à¸­, à¸•à¹ˆà¸²à¸‡à¸«à¸¹, à¸ˆà¸µà¹‰à¹€à¸à¸Šà¸£, à¸à¸£à¸°

### 11.3 Image Classification API

```
POST /api/image-classify
  - Input: image_url
  - Output: product_type, confidence_score
```

---

## 12. ğŸ”´ Vector Search Integration

### 12.1 Vector Search Steps

1. **Receive Image:** à¸£à¸±à¸šà¸£à¸¹à¸›à¸ à¸²à¸à¸ˆà¸²à¸à¸¥à¸¹à¸à¸„à¹‰à¸²
2. **Extract Features:** à¸”à¸¶à¸‡ features à¸ˆà¸²à¸à¸ à¸²à¸
3. **Convert to Vector:** à¹à¸›à¸¥à¸‡ features à¹€à¸›à¹‡à¸™ vector
4. **Search Vector Database:** à¸„à¹‰à¸™à¸«à¸² vector à¸—à¸µà¹ˆà¹ƒà¸à¸¥à¹‰à¹€à¸„à¸µà¸¢à¸‡à¹ƒà¸™à¸à¸²à¸™à¸‚à¹‰à¸­à¸¡à¸¹à¸¥
5. **Return Results:** à¸ªà¹ˆà¸‡à¸œà¸¥à¸¥à¸±à¸à¸˜à¹Œà¸à¸²à¸£à¸„à¹‰à¸™à¸«à¸²à¸à¸¥à¸±à¸šà¹„à¸›à¸¢à¸±à¸‡à¸¥à¸¹à¸à¸„à¹‰à¸²

### 12.2 Vector Search API

```
POST /api/vector-search
  - Input: image_url
  - Output: product_ref_ids[]
```

### 12.3 Vector Search Integration with NPD

1. **Vector Search:** à¸„à¹‰à¸™à¸«à¸² vector à¸—à¸µà¹ˆà¹ƒà¸à¸¥à¹‰à¹€à¸„à¸µà¸¢à¸‡
2. **Get Product Ref IDs:** à¸”à¸¶à¸‡ product_ref_ids à¸ˆà¸²à¸à¸œà¸¥à¸¥à¸±à¸à¸˜à¹Œ
3. **Search NPD API:** à¹ƒà¸Šà¹‰ product_ref_ids à¸„à¹‰à¸™à¸«à¸²à¸ªà¸´à¸™à¸„à¹‰à¸²à¹ƒà¸™ NPD
4. **Return Results:** à¸ªà¹ˆà¸‡à¸œà¸¥à¸¥à¸±à¸à¸˜à¹Œà¸à¸²à¸£à¸„à¹‰à¸™à¸«à¸²à¸à¸¥à¸±à¸šà¹„à¸›à¸¢à¸±à¸‡à¸¥à¸¹à¸à¸„à¹‰à¸²

---

## 13. ğŸ”´ Critical Edge Cases

### 13.1 Edge Case Scenarios

- **Multiple Intents:** à¸¥à¸¹à¸à¸„à¹‰à¸²à¸ªà¹ˆà¸‡à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸—à¸µà¹ˆà¸¡à¸µà¸«à¸¥à¸²à¸¢ intent à¹€à¸Šà¹ˆà¸™ "à¸ªà¸™à¹ƒà¸ˆà¸™à¸²à¸¬à¸´à¸à¸² Rolex à¹‚à¸­à¸™à¹à¸¥à¹‰à¸§"
- **Ambiguous Inputs:** à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸—à¸µà¹ˆà¹„à¸¡à¹ˆà¸Šà¸±à¸”à¹€à¸ˆà¸™ à¹€à¸Šà¹ˆà¸™ "à¹‚à¸­à¸™à¹à¸¥à¹‰à¸§" à¹à¸•à¹ˆà¹„à¸¡à¹ˆà¸¡à¸µà¸ªà¸¥à¸´à¸›
- **Context Switching:** à¸¥à¸¹à¸à¸„à¹‰à¸²à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¹€à¸£à¸·à¹ˆà¸­à¸‡à¸à¸¥à¸²à¸‡à¸„à¸±à¸™ à¹€à¸Šà¹ˆà¸™ à¸ˆà¸²à¸à¸–à¸²à¸¡à¸ªà¸´à¸™à¸„à¹‰à¸²à¹„à¸›à¸–à¸²à¸¡à¸à¸²à¸£à¸œà¹ˆà¸­à¸™
- **Spam Messages:** à¸¥à¸¹à¸à¸„à¹‰à¸²à¸ªà¹ˆà¸‡à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸‹à¹‰à¸³à¹† à¸«à¸£à¸·à¸­à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸—à¸µà¹ˆà¹„à¸¡à¹ˆà¹€à¸à¸µà¹ˆà¸¢à¸§à¸‚à¹‰à¸­à¸‡

### 13.2 Handling Edge Cases

- **Multiple Intents:** à¹ƒà¸Šà¹‰ LLM à¹ƒà¸™à¸à¸²à¸£à¹à¸¢à¸ intent à¹à¸¥à¸°à¸ˆà¸±à¸”à¸à¸²à¸£à¸—à¸µà¸¥à¸° intent
- **Ambiguous Inputs:** à¸–à¸²à¸¡à¸¥à¸¹à¸à¸„à¹‰à¸²à¹€à¸à¸·à¹ˆà¸­à¸‚à¸­à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹€à¸à¸´à¹ˆà¸¡à¹€à¸•à¸´à¸¡
- **Context Switching:** à¹€à¸à¹‡à¸š context à¸‚à¸­à¸‡à¸à¸²à¸£à¸ªà¸™à¸—à¸™à¸²à¹à¸¥à¸°à¸ˆà¸±à¸”à¸à¸²à¸£ context switch
- **Spam Messages:** à¹ƒà¸Šà¹‰ anti-spam logic à¹ƒà¸™à¸à¸²à¸£à¸à¸£à¸­à¸‡à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸—à¸µà¹ˆà¹„à¸¡à¹ˆà¹€à¸à¸µà¹ˆà¸¢à¸§à¸‚à¹‰à¸­à¸‡

---

## ğŸ“… Timeline (Estimated)

| Phase | à¸‡à¸²à¸™ | à¸£à¸°à¸¢à¸°à¹€à¸§à¸¥à¸² |
|-------|-----|----------|
| 1 | Database & Foundation | 2-3 à¸§à¸±à¸™ |
| 2 | Bot APIs | 3-4 à¸§à¸±à¸™ |
| 3 | Admin APIs | 2-3 à¸§à¸±à¸™ |
| 4 | Bot Profile & Router | 3-4 à¸§à¸±à¸™ |
| 5 | Admin Screens | 3-4 à¸§à¸±à¸™ |
| 6 | Integration & Testing | 2-3 à¸§à¸±à¸™ |
| **à¸£à¸§à¸¡** | | **15-21 à¸§à¸±à¸™** |

---

*Document version: 2.0*  
*Last updated: 2026-01-06*
