# 🔗 LIFF เชื่อมโยงกับ campaigns.php อย่างไร?

**วันที่:** 3 มกราคม 2026  
**คำถาม:** "LIFF มันจะเชื่อมโยงกับหน้า campaigns.php ไหม?"

---

## 🎯 คำตอบสั้นๆ: เชื่อมโยง 100%!

### ระบบของคุณทำงานแบบนี้:

```
Admin (คุณ)                         Database                    User (ลูกค้า)
    │                                  │                             │
    │  1️⃣ สร้างแคมเปญ                 │                             │
    ├──────────────────────────────────▶                             │
    │  campaigns.php                    │                             │
    │  - ชื่อ: "สมัครสินเชื่อ"         │                             │
    │  - คำถาม 20-30 ข้อ:               │                             │
    │    1. ชื่อ-นามสกุล?               │                             │
    │    2. เบอร์โทร?                   │                             │
    │    3. ที่อยู่?                    │                             │
    │    ... (30 ข้อ)                   │                             │
    │  - LIFF ID                        │                             │
    │                                   │                             │
    │                                   │  บันทึกใน campaigns table  │
    │                                   │  {                          │
    │                                   │    code: "LOAN2026",        │
    │                                   │    name: "สมัครสินเชื่อ",   │
    │                                   │    form_config: {           │
    │                                   │      questions: [           │
    │                                   │        {id: "q1", ...},     │
    │                                   │        {id: "q2", ...},     │
    │                                   │        ...                  │
    │                                   │      ]                      │
    │                                   │    },                       │
    │                                   │    liff_id: "xxx"           │
    │                                   │  }                          │
    │                                   │                             │
    │                                   │  2️⃣ User แชทกับ Bot         │
    │                                   │                             ◀───
    │                                   │                             │ "แคมเปญ"
    │                                   │                             │
    │                                   │  3️⃣ Bot ดึงข้อมูลจาก DB    │
    │                                   ◀─────────────────────────────┤
    │                                   │  SELECT * FROM campaigns    │
    │                                   │  WHERE code = 'LOAN2026'    │
    │                                   │                             │
    │                                   │  4️⃣ Bot ส่งลิงก์ LIFF       │
    │                                   ├─────────────────────────────▶
    │                                   │  "👉 สมัครเลย:             │
    │                                   │   https://liff.line.me/xxx  │
    │                                   │   ?campaign=LOAN2026"       │
    │                                   │                             │
    │                                   │  5️⃣ User คลิกลิงก์          │
    │                                   │                             │
    │                                   │  6️⃣ LIFF ดึงคำถามจาก DB    │
    │                                   ◀─────────────────────────────┤
    │                                   │  SELECT form_config         │
    │                                   │  FROM campaigns             │
    │                                   │  WHERE code = 'LOAN2026'    │
    │                                   │                             │
    │                                   │  7️⃣ แสดงฟอร์ม 20-30 ข้อ   │
    │                                   ├─────────────────────────────▶
    │                                   │  [แสดงคำถามตามที่ Admin    │
    │                                   │   ตั้งไว้ใน campaigns.php]  │
    │                                   │                             │
    │                                   │  8️⃣ User กรอกและ Submit    │
    │                                   ◀─────────────────────────────┤
    │                                   │  {                          │
    │                                   │    q1: "จอห์น ดู",          │
    │                                   │    q2: "0812345678",        │
    │                                   │    ...                      │
    │                                   │  }                          │
    │                                   │                             │
    │                                   │  บันทึกใน line_applications│
    │                                   │                             │
    │  9️⃣ Admin ดูใบสมัคร             │                             │
    ◀──────────────────────────────────┤                             │
    │  line-applications.php            │                             │
    │  [แสดงข้อมูลที่ User กรอก]        │                             │
```

---

## 📋 ตัวอย่างจริงๆ

### 1️⃣ Admin สร้างแคมเปญใน campaigns.php

คุณกรอกแบบนี้:

```
┌──────────────────────────────────────────────────────┐
│  🎯 จัดการแคมเปญ                                    │
├──────────────────────────────────────────────────────┤
│                                                      │
│  📋 ข้อมูลพื้นฐาน                                   │
│  ┌────────────────────────────────────────────────┐ │
│  │ รหัสแคมเปญ: LOAN2026                          │ │
│  │ ชื่อแคมเปญ: สมัครสินเชื่อบ้าน                 │ │
│  │ LIFF ID: 1234567890-AbCdEfGh                   │ │
│  └────────────────────────────────────────────────┘ │
│                                                      │
│  ❓ ฟอร์มคำถาม (20-30 ข้อ)                          │
│  ┌────────────────────────────────────────────────┐ │
│  │ คำถามที่ 1                                     │ │
│  │ ชนิด: Text                                     │ │
│  │ คำถาม: "ชื่อ-นามสกุล"                         │ │
│  │ จำเป็น: ✅                                     │ │
│  ├────────────────────────────────────────────────┤ │
│  │ คำถามที่ 2                                     │ │
│  │ ชนิด: Tel                                      │ │
│  │ คำถาม: "เบอร์โทรศัพท์"                        │ │
│  │ จำเป็น: ✅                                     │ │
│  ├────────────────────────────────────────────────┤ │
│  │ คำถามที่ 3                                     │ │
│  │ ชนิด: Select                                   │ │
│  │ คำถาม: "อาชีพ"                                 │ │
│  │ ตัวเลือก:                                      │ │
│  │   - พนักงานบริษัท                              │ │
│  │   - ธุรกิจส่วนตัว                               │ │
│  │   - อื่นๆ                                      │ │
│  │ จำเป็น: ✅                                     │ │
│  ├────────────────────────────────────────────────┤ │
│  │ ... (คำถามที่ 4-30)                            │ │
│  └────────────────────────────────────────────────┘ │
│                                                      │
│  [💾 บันทึกแคมเปญ]                                  │
└──────────────────────────────────────────────────────┘
```

**บันทึกลง Database:**

```json
{
  "code": "LOAN2026",
  "name": "สมัครสินเชื่อบ้าน",
  "liff_id": "1234567890-AbCdEfGh",
  "form_config": {
    "questions": [
      {
        "id": "q1",
        "type": "text",
        "label": "ชื่อ-นามสกุล",
        "required": true,
        "validation": {"minLength": 2}
      },
      {
        "id": "q2",
        "type": "tel",
        "label": "เบอร์โทรศัพท์",
        "required": true,
        "validation": {"pattern": "[0-9]{10}"}
      },
      {
        "id": "q3",
        "type": "select",
        "label": "อาชีพ",
        "options": ["พนักงานบริษัท", "ธุรกิจส่วนตัว", "อื่นๆ"],
        "required": true
      }
      // ... คำถาม 4-30
    ]
  }
}
```

---

### 2️⃣ User แชทกับ Bot

```
👤 User: "แคมเปญ"

🤖 Bot: (ดึงข้อมูลจาก campaigns table)
        "😊 มีแคมเปญที่เปิดรับสมัครอยู่นะคะ
        
        📋 สมัครสินเชื่อบ้าน
           💬 อนุมัติง่าย ดอกเบี้ยต่ำ
           
           👉 สมัครเลย: https://liff.line.me/1234567890-AbCdEfGh?campaign=LOAN2026"
```

---

### 3️⃣ User คลิก LIFF → เปิดฟอร์ม

LIFF จะ:
1. รับ parameter `?campaign=LOAN2026`
2. Query database:
   ```sql
   SELECT form_config FROM campaigns WHERE code = 'LOAN2026'
   ```
3. **วนลูปสร้างฟอร์มตาม JSON ที่ Admin ตั้งไว้!**

```
┌─────────────────────────────────────┐
│ 📋 ฟอร์มสมัครสินเชื่อบ้าน           │
├─────────────────────────────────────┤
│                                     │
│ ชื่อ-นามสกุล *                      │
│ [_________________________]        │
│                                     │
│ เบอร์โทรศัพท์ *                     │
│ [_________________________]        │
│ ตัวอย่าง: 0812345678              │
│                                     │
│ อาชีพ *                             │
│ [▼ เลือก                   ]       │
│   - พนักงานบริษัท                  │
│   - ธุรกิจส่วนตัว                   │
│   - อื่นๆ                          │
│                                     │
│ ... (คำถาม 4-30 ตามที่ Admin ตั้ง) │
│                                     │
│ [✅ ส่งข้อมูล]                     │
└─────────────────────────────────────┘
```

---

### 4️⃣ User Submit → บันทึกใน Database

```sql
INSERT INTO line_applications (
  campaign_id,
  campaign_code,
  line_user_id,
  form_data,
  status
) VALUES (
  1,
  'LOAN2026',
  'Uxxx',
  '{"q1": "จอห์น ดู", "q2": "0812345678", "q3": "พนักงานบริษัท", ...}',
  'RECEIVED'
);
```

---

### 5️⃣ Admin ดูใบสมัคร

```
┌──────────────────────────────────────────────────────┐
│  📋 ใบสมัครสินเชื่อบ้าน                              │
├──────────────────────────────────────────────────────┤
│  เลขที่: APP-20260103-001                            │
│  สถานะ: 📥 ได้รับใบสมัคร                             │
│                                                      │
│  ข้อมูลผู้สมัคร:                                     │
│  ┌────────────────────────────────────────────────┐ │
│  │ ชื่อ-นามสกุล: จอห์น ดู                        │ │
│  │ เบอร์โทรศัพท์: 0812345678                     │ │
│  │ อาชีพ: พนักงานบริษัท                           │ │
│  │ ... (คำตอบ 30 ข้อ)                             │ │
│  └────────────────────────────────────────────────┘ │
│                                                      │
│  [✅ อนุมัติ]  [❌ ปฏิเสธ]  [📄 ขอเอกสารเพิ่ม]      │
└──────────────────────────────────────────────────────┘
```

---

## 🔑 ประเด็นสำคัญ

### ✅ เชื่อมกัน 100% ผ่าน:

1. **Database Table: `campaigns`**
   - Admin ตั้งคำถามใน `campaigns.php`
   - บันทึกใน `form_config` JSON
   - LIFF อ่าน `form_config` แล้วสร้างฟอร์ม

2. **LIFF ID**
   - Admin ใส่ LIFF ID ใน `campaigns.php`
   - Bot ดึง LIFF ID จาก Database
   - ส่งลิงก์ให้ User

3. **Form Data**
   - User กรอกฟอร์ม (ตามที่ Admin ตั้ง)
   - บันทึกใน `line_applications.form_data` JSON
   - Admin ดูได้ใน `line-applications.php`

---

## 🎨 ตอนนี้ LIFF Form ที่ผมสร้างให้

**ปัญหา:** LIFF Form ที่ผมสร้างเป็น **Static** (Fixed 5 ข้อ)

```html
<!-- LIFF Form ปัจจุบัน (Static) -->
<form>
  <input name="firstName"> <!-- Fixed! -->
  <input name="lastName">  <!-- Fixed! -->
  <input name="phone">     <!-- Fixed! -->
  <input name="email">     <!-- Fixed! -->
  <textarea name="address"><!-- Fixed! -->
</form>
```

**ที่ควรเป็น:** LIFF Form ที่เป็น **Dynamic** (อ่านจาก Database)

```javascript
// LIFF Form ที่ควรเป็น (Dynamic)
// 1. ดึง campaign code จาก URL
const campaignCode = urlParams.get('campaign'); // 'LOAN2026'

// 2. Query API ดึง form_config
const response = await fetch(`/api/campaigns/${campaignCode}`);
const campaign = await response.json();

// 3. สร้างฟอร์มตาม form_config.questions
campaign.form_config.questions.forEach(question => {
  if (question.type === 'text') {
    formHTML += `<input type="text" name="${question.id}" ...>`;
  } else if (question.type === 'select') {
    formHTML += `<select name="${question.id}">...`;
  }
  // ... etc
});
```

---

## 🚀 สิ่งที่ต้องทำต่อ

### Option 1: ใช้ LIFF แบบ Static (เร็ว - 0 นาที)

✅ **ข้อดี:**
- ใช้งานได้ทันที
- Setup LIFF ID เสร็จแล้วพร้อมใช้

❌ **ข้อเสีย:**
- คำถามตายตัว 5 ข้อ (ชื่อ, นามสกุล, เบอร์, อีเมล, ที่อยู่)
- ไม่ตรงกับ form_config ที่ตั้งใน campaigns.php

### Option 2: ทำ LIFF แบบ Dynamic (แนะนำ - 2-3 ชั่วโมง)

✅ **ข้อดี:**
- อ่านคำถามจาก Database
- ตรงกับ form_config 100%
- เพิ่ม/ลด คำถามได้ตาม Admin ตั้ง

❌ **ข้อเสีย:**
- ต้องเขียน Code เพิ่ม

---

## 💡 สรุป

### คำตอบคำถามคุณ:

> "LIFF มันจะเชื่อมโยงกับที่ฉันทำไหมในหน้า campaigns.php?"

**ตอบ: ใช่! เชื่อมโยงกัน 100%!** 🎉

### การเชื่อมโยง:

```
campaigns.php (Admin)
    ↓ บันทึก
campaigns table (Database)
    ↓ อ่าน
LIFF Form (User)
    ↓ Submit
line_applications table
    ↓ แสดง
line-applications.php (Admin)
```

### ตอนนี้:

- ✅ Backend เชื่อมโยงกันแล้ว (Database)
- ✅ LIFF Form พร้อมใช้ (แบบ Static)
- ⚠️ ถ้าต้องการ Dynamic → ต้องแก้ LIFF Form

---

**ต้องการให้ผมช่วยอะไรต่อไหมคะ?**

1. Setup LIFF ID ให้แบบ Static (ใช้ได้เลย)?
2. ทำ LIFF Form แบบ Dynamic (อ่านจาก form_config)?
3. อธิบายเพิ่มเติมตรงไหน?

บอกผมได้เลยค่ะ! 😊
